<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>×˜×•×¤×¡ ×¤×ª×™×—×ª ×œ×§×•×— ×—×“×©</title>
<style>
  /* ğŸ¨ ×¡×’× ×•×Ÿ ×‘×¡×™×¡×™ ×œ×’×•×£ ×”×“×£ */
body {
  font-family: Arial, sans-serif;
  direction: rtl;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: flex-start; /* âœ… ×©×™× ×•×™ ×-center ×œ-flex-start ×›×“×™ ×œ×”×‘×˜×™×— ×©×”×˜×•×¤×¡ ×ª××™×“ ××ª×—×™×œ ××”×—×œ×§ ×”×¢×œ×™×•×Ÿ */
  min-height: 100vh;
  padding-top: 30px; /* âœ… ××•×¡×™×£ ×¨×™×•×•×— ×¢×œ×™×•×Ÿ ×œ×˜×•×¤×¡ */
  margin: 0;
}

/* ğŸ“ ××™×›×œ ×”×˜×•×¤×¡ */
.form-container {
  background: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
  width: 600px;
  text-align: right;
  position: relative;
}

/* ğŸ—ï¸ ×§×‘×•×¦×•×ª ×©×“×•×ª */
.form-group {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
}

/* ğŸ·ï¸ ×ª×’×™×•×ª ×•×©×“×•×ª ×§×œ×˜ */
label {
  font-weight: bold;
  width: 30%;
}

/* ğŸ§¾ ×©×“×•×ª ×§×œ×˜ ×¨×’×™×œ×™× ×•×¡×œ×§×˜ */
input, select {
  width: 65%;
  padding: 6px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  background-color: white;
  box-sizing: border-box;
}

/* ğŸ”’ ×©×“×•×ª ×œ×§×¨×™××” ×‘×œ×‘×“ */
input[readonly] {
  background-color: #f0f0f0;
  cursor: not-allowed;
}

/* â›”ï¸ ×©×“×” ×¡×™×¡××” ××•×¡×ª×¨ */
input[type="password"] {
  position: absolute;
  left: -9999px;
}

/* ğŸ”” ×—×™×•×•×™ ×©×’×™××” */
#warningMessage {
  color: red;
  display: none;
  font-size: 14px;
  text-align: center;
}

/* ğŸ”½ 9ï¸âƒ£ ×›×¤×ª×•×¨ ×’×œ×™×œ×” ×œ×¡×•×£ ×”×˜×•×¤×¡ */
.scroll-button {
    background-color: #2196F3;
    color: white;
    font-size: 14px;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    width: auto;
    margin: 10px auto;
}

/* ğŸ§­ ×××•×¨×›×– */
.center-button {
    display: flex;
    justify-content: center;
}


/* âœ… ×¢×™×¦×•×‘ ×›×¤×ª×•×¨×™× */
button {
  margin-top: 15px;
  padding: 10px;
  font-size: 14px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  width: 48%;
}

/* ×›×¤×ª×•×¨ ××™×©×•×¨ */
#submitButton {
  background-color: #4CAF50;
  color: white;
}

#submitButton:disabled {
  background-color: #cccccc;
}

/* ×›×¤×ª×•×¨ ×‘×™×˜×•×œ */
#cancelButton {
  background-color: #f44336;
  color: white;
}

/* ğŸ›ï¸ ×§×‘×•×¦×ª ×›×¤×ª×•×¨×™× */
.button-container {
  display: flex;
  justify-content: space-between;
}

/* ğŸ”„ ×”×•×“×¢×ª ×˜×¢×™× ×” ×¢×œ×™×•× ×” */
#loadingMessage {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: rgba(255, 255, 0, 0.85);
  color: black;
  text-align: center;
  font-size: 16px;
  font-weight: bold;
  padding: 10px;
  z-index: 1000;
  display: none;
}

/* ğŸ”„ ×§×•×¤×¡×ª ×˜×¢×™× ×” ×‘××¨×›×– */
.loading-container {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 18px;
  font-weight: bold;
  color: blue;
  background: rgba(255, 255, 255, 0.9);
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ğŸ¡ ×× ×™××¦×™×™×ª ×¡×¤×™× ×¨ */
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ğŸ¡ ×¡×¤×™× ×¨ ×˜×•×¢×Ÿ */
.spinner {
  display: inline-block;
  width: 16px;
  height: 16px;
  border: 2px solid black;
  border-top: 2px solid transparent;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-left: 10px;
}

</style>

      <script>
  
  // ××©×ª× ×” ×©×™×—×–×™×§ ××ª ×¨×©×™××ª ×”×œ×§×•×—×•×ª ×”×§×™×™××™×
  let existingCustomers = [];

document.addEventListener("DOMContentLoaded", function () {
    try {
        console.log("ğŸ“Œ ×˜×¢×™× ×ª ×”×˜×•×¤×¡ - ××ª×—×™×œ×™× ×‘×ª×”×œ×™×š.");

        // âœ… ×”×©×‘×ª×ª ×›×œ ×”×˜×•×¤×¡ ×¢×“ ×¡×™×•× ×˜×¢×™× ×ª ×”× ×ª×•× ×™×
        disableForm();
        

        // âœ… ×©×œ×™×—×ª ×‘×§×©×” ×œ×©×¨×ª ×œ×§×‘×œ×ª × ×ª×•× ×™× ×¨××©×•× ×™×™×
        google.script.run.withSuccessHandler(handleFormData).processCustomerForm();

        console.log("ğŸ“Œ ×”×ª×—×œ×ª ×˜×¢×™× ×ª ×××–×™× ×™× ×œ×©×“×•×ª ×”×˜×•×¤×¡");

        let requiredFields = ["customerName", "taxID", "address", "email", "contactName", "contactPhone", "contactEmail", "projectName"];
        let submitButton = document.getElementById("submitButton");

        if (!submitButton) {
            console.error("âŒ ×›×¤×ª×•×¨ ×”××™×©×•×¨ ×œ× × ××¦× ×‘-DOM");
            return;
        }

        requiredFields.forEach((fieldID, index) => {
            let field = document.getElementById(fieldID);
            if (!field) {
                console.error(`âš ï¸ ×©×“×” ×œ× × ××¦×: ${fieldID}`);
                return;
            }

            if (fieldID === "customerName") {
                // ×‘×“×™×§×” ×ª×•×š ×›×“×™ ×”×§×œ×“×” ×× ×”×œ×§×•×— ×§×™×™×
                field.addEventListener("input", checkCustomerExists);
                console.log("âœ… ×××–×™×Ÿ 'input' × ×•×¡×£ ×œ×©×“×” ×©× ×œ×§×•×— ×œ×‘×“×™×§×” ×‘×–××Ÿ ×××ª");
            } else if (index === requiredFields.length - 1) {
                // ×”×©×“×” ×”××—×¨×•×Ÿ: ×”×‘×“×™×§×” ×ª×ª×¨×—×© ×ª×•×š ×›×“×™ ×”×§×œ×“×”
                field.addEventListener("input", function () {
                    validateForm(true); // ×§×¨×™××” ×¢× ×¤×¨××˜×¨ ×©××•×“×™×¢ ×©×–×” ×”×©×“×” ×”××—×¨×•×Ÿ
                });
                console.log(`âœ… ×××–×™×Ÿ 'input' × ×•×¡×£ ×œ×©×“×” ×”××—×¨×•×Ÿ: ${fieldID}`);
            } else {
                // ×›×œ ×”×©×“×•×ª ×”××—×¨×™×: ×‘×“×™×§×” ×¨×§ ×œ××—×¨ ×™×¦×™××” (blur)
                field.addEventListener("blur", validateForm);
                console.log(`âœ… ×××–×™×Ÿ 'blur' × ×•×¡×£ ×œ×©×“×”: ${fieldID}`);
            }
        });
        document.querySelectorAll("input, select").forEach(input => {
        input.addEventListener("input", validateForm);
        });

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×§×¨×™×˜×™×ª ×‘×”×’×“×¨×ª ×××–×™× ×™× ×œ×©×“×•×ª ×”×˜×•×¤×¡:", error);
    }
});

/**
 * ğŸ¯ ××˜×¤×œ×ª ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×¤×ª×™×—×ª ×˜×•×¤×¡ ×œ×§×•×— ×—×“×© ×¢× ×›×œ ×”×¢×¨×›×™× ×”× ×“×¨×©×™× ××”×©×¨×ª.
 * 
 * ğŸ“Œ ×©×œ×‘×™ ×”×¤×¢×•×œ×”:
 * 1ï¸âƒ£ ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×”× ×ª×•× ×™× ×©×”×ª×§×‘×œ×• ××”×©×¨×ª.
 * 2ï¸âƒ£ ××™×œ×•×™ ×©×“×•×ª ××¢×¨×›×ª×™×™× (×ª××¨×™×›×™×, ××–×”×™×, ×©× ×¤×¨×•×™×§×˜).
 * 3ï¸âƒ£ ×˜×¢×™× ×ª ×¨×©×™××ª ×œ×§×•×—×•×ª ×§×™×™××™×.
 * 4ï¸âƒ£ ×˜×¢×™× ×ª ×¨×©×™××ª ××§×‘×œ×™ ×¢××œ×” ×œ×¨×©×™××ª ×‘×—×™×¨×” + ×¢×“×›×•×Ÿ ×©×“×•×ª × ×œ×•×•×™×.
 * 5ï¸âƒ£ ×”×¦×’×ª ×”×•×“×¢×ª ×©×’×™××” ×‘××§×¨×” ×©×œ ×—×•×¡×¨ × ×ª×•× ×™×.
 * 6ï¸âƒ£ ×”×¤×¢×œ×ª ×”×˜×•×¤×¡ ×œ×©×™××•×© ×× ×”×›×œ ×ª×§×™×Ÿ.
 * 
 * @param {Object} data - ×”× ×ª×•× ×™× ×©×”×ª×§×‘×œ×• ××”×©×¨×ª.
 * @property {Object} data.generatedFields - × ×ª×•× ×™× ××—×•×©×‘×™× ××¨××© (××–×”×™×, ×ª××¨×™×›×™×).
 * @property {string[]} data.existingCustomers - ×¨×©×™××ª ×©××•×ª ×œ×§×•×—×•×ª ×§×™×™××™×.
 * @property {Array<{name: string, rate: number, months: number}>} data.commissionRecipients - ×¨×©×™××ª ××§×‘×œ×™ ×¢××œ×”.
 */
function handleFormData(data) {
    try {
        console.log("ğŸ“¡ ×§×‘×œ×ª × ×ª×•× ×™× ××”×©×¨×ª:", data);

        // ğŸ” ×©×œ×‘ 1: ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×”× ×ª×•× ×™×
        if (!data || !data.generatedFields) {
            console.error("âŒ ×©×’×™××”: ×”× ×ª×•× ×™× ×©×”×ª×§×‘×œ×• ××”×©×¨×ª ×¨×™×§×™× ××• ×œ× ×ª×§×™× ×™×.");
            document.getElementById("loadingMessage").innerText = "âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×";
            return;
        }

        // ğŸ§© ×©×œ×‘ 2: ××™×œ×•×™ ×©×“×•×ª ××¢×¨×›×ª×™×™×
        const creationDate = data.generatedFields.creationDate || "";
        const customerID = data.generatedFields.customerID || "";
        const entryDate = data.generatedFields.entryDate || "";
        const projectID = data.generatedFields.projectID || "";
        const projectName = `×©×™×•×•×§ ${creationDate}`;

        document.getElementById("creationDate").value = creationDate;
        document.getElementById("customerID").value = customerID;
        document.getElementById("entryDate").value = entryDate;
        document.getElementById("projectID").value = projectID;
        document.getElementById("projectName").value = projectName;
        console.log("ğŸ§¾ ×©×“×•×ª ××¢×¨×›×ª×™×™× ××•×œ××• ×‘×”×¦×œ×—×”.");

        // ğŸ‘¥ ×©×œ×‘ 3: ×˜×¢×™× ×ª ×¨×©×™××ª ×œ×§×•×—×•×ª ×§×™×™××™×
        if (data.existingCustomers) {
            existingCustomers = data.existingCustomers;
            console.log("âœ… ×¨×©×™××ª ×”×œ×§×•×—×•×ª ×”×§×™×™××™× × ×˜×¢× ×”:", existingCustomers);
        }

        // ğŸ’¼ ×©×œ×‘ 4: ×˜×¢×™× ×ª ××§×‘×œ×™ ×”×¢××œ×” ×•×”×’×“×¨×ª ×©×“×•×ª × ×œ×•×•×™×
        if (Array.isArray(data.commissionRecipients)) {
            const select = document.getElementById("commissionRecipient");
            const rateField = document.getElementById("commissionRate");
            const monthsField = document.getElementById("commissionMonths");

            if (select && rateField && monthsField) {
                // ××™×¤×•×¡ ×”×¨×©×™××” ×•×”×•×¡×¤×ª ×‘×¨×™×¨×ª ××—×“×œ
                select.innerHTML = "";
                const defaultOption = document.createElement("option");
                defaultOption.value = "";
                defaultOption.textContent = "-- ×œ×œ× ××§×‘×œ ×¢××œ×” --";
                select.appendChild(defaultOption);

                // ×”×•×¡×¤×ª ×›×œ ××§×‘×œ×™ ×”×¢××œ×” ×œ×¨×©×™××”
                data.commissionRecipients.forEach(recipient => {
                    const option = document.createElement("option");
                    option.value = recipient.name;
                    option.textContent = recipient.name;
                    select.appendChild(option);
                });

                // ×”××–× ×” ×œ×‘×—×™×¨×” ×•×¢×“×›×•×Ÿ ×©×“×•×ª × ×œ×•×•×™×
                select.addEventListener("change", () => {
                    const selected = select.value;
                    const found = data.commissionRecipients.find(r => r.name === selected);
                    rateField.value = found ? found.rate : "";
                    monthsField.value = found ? found.months : "";
                    console.log(`ğŸ“Œ ××§×‘×œ ×¢××œ×” × ×‘×—×¨: ${selected} | ××—×•×–: ${rateField.value} | ×—×•×“×©×™×: ${monthsField.value}`);
                });

                console.log("âœ… ××§×‘×œ×™ ×¢××œ×” × ×˜×¢× ×• ×•×”×•×–× ×• ×œ×¨×©×™××”.");
            } else {
                console.warn("âš ï¸ ××œ×× ×˜×™× commissionRecipient / commissionRate / commissionMonths ×œ× × ××¦××• ×‘-DOM.");
            }
        } else {
            console.warn("âš ï¸ ×œ× ×”×ª×§×‘×œ×” ×¨×©×™××ª ××§×‘×œ×™ ×¢××œ×” ××”×©×¨×ª.");
        }

        // âœ… ×©×œ×‘ 5: ×‘×“×™×§×” ×¡×•×¤×™×ª ×©×›×œ ×”× ×ª×•× ×™× ×§×™×™××™× ×œ×¤× ×™ ×”×¤×¢×œ×ª ×”×˜×•×¤×¡
        const allGood = creationDate && customerID && entryDate && projectID && projectName && existingCustomers.length >= 0;
        if (allGood) {
            console.log("âœ… ×›×œ ×”× ×ª×•× ×™× × ×˜×¢× ×• ×‘×”×¦×œ×—×” - ×××¤×©×¨×™× ×©×™××•×© ×‘×˜×•×¤×¡.");
            enableForm();
        } else {
            console.error("âŒ × ×ª×•× ×™× ×§×¨×™×˜×™×™× ×—×¡×¨×™× - ×”×©×™××•×© ×‘×˜×•×¤×¡ ×œ× ×™×ª××¤×©×¨.");
            document.getElementById("loadingMessage").innerText = "âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×. × ×¡×” ×œ×¨×¢× ×Ÿ.";
        }

    } catch (error) {
        // ğŸ§¯ ×˜×™×¤×•×œ ×‘×©×’×™××•×ª ×›×œ×œ×™×•×ª
        console.error("âŒ ×©×’×™××” ×‘×œ×ª×™ ×¦×¤×•×™×” ×‘-handleFormData:", error);
        document.getElementById("loadingMessage").innerText = "âŒ ×©×’×™××” ×›×œ×œ×™×ª. × ×¡×” ×œ×¨×¢× ×Ÿ.";
    }
}


/**
 * ğŸš€ disableForm - ××©×‘×™×ª ××ª ×›×œ ×”×©×“×•×ª ×‘×˜×•×¤×¡ ×¢×“ ×§×‘×œ×ª × ×ª×•× ×™× ××”×©×¨×ª.
 * âœ… ××•× ×¢ ×××©×ª××©×™× ×œ××œ× × ×ª×•× ×™× ×œ×¤× ×™ ×©×”×©×¨×ª ×”×—×–×™×¨ ×ª×©×•×‘×•×ª.
 */
function disableForm() {
    try {
        console.log("â³ ×”×©×‘×ª×ª ×”×˜×•×¤×¡ - ××—×›×™× ×œ× ×ª×•× ×™× ××”×©×¨×ª...");
        document.getElementById("loadingMessage").style.display = "block";
        document.querySelectorAll("input, button, select").forEach(el => el.disabled = true);
        document.getElementById("submitButton").disabled = true;
    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×”×©×‘×ª×ª ×”×˜×•×¤×¡:", error);
    }
}

/**
 * ğŸš€ enableForm - ××©×—×¨×¨ ××ª ×”×˜×•×¤×¡ ×œ××—×¨ ×§×‘×œ×ª × ×ª×•× ×™× ××”×©×¨×ª.
 * âœ… ×××¤×©×¨ ×œ××©×ª××©×™× ×œ×”×ª×—×™×œ ×œ××œ× × ×ª×•× ×™× ×œ××—×¨ ×©×”×›×œ ××•×›×Ÿ.
 */
function enableForm() {
    try {
        console.log("âœ… ×©×—×¨×•×¨ ×”×˜×•×¤×¡ - ×”× ×ª×•× ×™× × ×˜×¢× ×• ×‘×”×¦×œ×—×”!");
        document.getElementById("loadingMessage").style.display = "none";
        document.querySelectorAll("input, button, select").forEach(el => el.disabled = false);
        validateForm()
        // âœ… ×•×•×™×“×•× ×©×”××©×ª××© ×¨×•××” ××ª ×”×˜×•×¤×¡ ×•××™×§×•×“ ×‘×©×“×” ×”×¨××©×•×Ÿ
        let firstInput = document.getElementById("customerName");
        if (firstInput) {
            firstInput.focus();
            console.log("ğŸ“Œ ×”×¤×•×§×•×¡ ×”×•×¢×‘×¨ ×œ×©×“×” '×©× ×œ×§×•×—'.");
        }
    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×©×—×¨×•×¨ ×”×˜×•×¤×¡:", error);
    }
}

/**
 * ğŸš€ ×¤×•× ×§×¦×™×” ×œ×‘×“×™×§×” ×× ×©× ×”×œ×§×•×— ×›×‘×¨ ×§×™×™×
 * 
 * ğŸ“Œ ×ª×”×œ×™×š ×”×¢×‘×•×“×”:
 * 1ï¸âƒ£ ×‘×•×“×§×ª ×× ×”×©×“×” ×¨×™×§ â†’ ××•× ×¢×ª ×™×¦×™××”, ××¦×™×’×” ×©×’×™××”, ×•××—×–×™×¨×” ×¤×•×§×•×¡.
 * 2ï¸âƒ£ ×× ×”×©× ×›×‘×¨ ×§×™×™× ×‘×¨×©×™××ª ×”×œ×§×•×—×•×ª â†’ ××¦×™×’×” ×—×™×•×•×™ ×•××•× ×¢×ª ×”××©×š.
 * 3ï¸âƒ£ ×× ×”×©× **×ª×§×™×Ÿ ×•×™×™×—×•×“×™** â†’ ××¡×ª×™×¨×” ××ª ×”×—×™×•×•×™ ×•×××¤×©×¨×ª ×”××©×š ××™×œ×•×™ ×˜×•×¤×¡.
 * 4ï¸âƒ£ **×œ× ××¢×“×›× ×ª × ×ª×•× ×™×** â€“ ×¨×§ ××‘×¦×¢×ª ×‘×“×™×§×”.
 */
function checkCustomerExists() {
    try {
        let customerNameField = document.getElementById("customerName");
        let customerName = customerNameField.value.trim();
        let warningMessage = document.getElementById("warningMessage");
        let submitButton = document.getElementById("submitButton");

        if (!customerNameField || !warningMessage || !submitButton) {
            console.error("âŒ ×”××œ×× ×˜×™× ×”× ×“×¨×©×™× ×œ× × ××¦××•.");
            return;
        }

        // ğŸ”¹ 1ï¸âƒ£ ×‘×“×™×§×” ×× ×”×©×“×” ×¨×™×§
        if (customerName === "") {
            console.warn("âš ï¸ ×”×©×“×” '×©× ×œ×§×•×—' ×¨×™×§ - ×œ× ×××¤×©×¨ ×™×¦×™××”.");
            warningMessage.innerText = "âš ï¸ ×™×© ×œ×”×–×™×Ÿ ×©× ×œ×§×•×—!";
            warningMessage.style.display = "block";
            customerNameField.focus(); // âŒ ××—×–×™×¨ ××ª ×”×¤×•×§×•×¡ ×œ×©×“×”
            return;
        }

        // ğŸ”¹ 2ï¸âƒ£ ×‘×“×™×§×” ×× ×”×œ×§×•×— ×›×‘×¨ ×§×™×™×
        if (existingCustomers.includes(customerName)) {
            console.warn(`âš ï¸ ×”×œ×§×•×— '${customerName}' ×›×‘×¨ ×§×™×™× - ×›×¤×ª×•×¨ ×”×©×œ×™×—×” ××•×©×‘×ª.`);
            warningMessage.innerText = `âš ï¸ ×”×œ×§×•×— '${customerName}' ×›×‘×¨ ×§×™×™× ×‘××¢×¨×›×ª!`;
            warningMessage.style.display = "block";
            submitButton.disabled = true; // âŒ ××•× ×¢ ×©×œ×™×—×”
        } else {
            console.log(`âœ… ×©× ×”×œ×§×•×— '${customerName}' ×ª×§×™×Ÿ.`);
            warningMessage.style.display = "none"; // âœ… ×”×¡×¨×ª ×”×•×“×¢×ª ×”×©×’×™××”
            submitButton.disabled = false; // âœ… ×××¤×©×¨ ×©×œ×™×—×”
        }

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×‘×“×™×§×ª ×©× ×œ×§×•×—:", error);
    }
}

/**
 * ğŸ”½ scrollToSubmit - ××’×œ×’×œ ××ª ×”××¡×š ×‘×¦×•×¨×” ×—×œ×§×” ××œ ×›×¤×ª×•×¨×™ ×”×©×œ×™×—×” ×‘×ª×—×ª×™×ª ×”×˜×•×¤×¡
 * 
 * ğŸ“Œ ×ª×”×œ×™×š ×”×¢×‘×•×“×”:
 * 1ï¸âƒ£ ×××ª×¨ ××ª ×›×¤×ª×•×¨ ×”×©×œ×™×—×” ×œ×¤×™ ××–×”×”.
 * 2ï¸âƒ£ ×× ×”×›×¤×ª×•×¨ ×§×™×™× â€“ ××¤×¢×™×œ scroll ×—×œ×§ ×›×“×™ ×œ×”×‘×™× ××•×ª×• ×œ××¨×›×– ×”××¡×š.
 * 3ï¸âƒ£ ×¨×•×©× ×œ×•×’ ×œ××™××•×ª ×”×¦×œ×—×”.
 * 4ï¸âƒ£ ×× ×œ× × ××¦× ×”×›×¤×ª×•×¨ â€“ ×¨×•×©× ×©×’×™××”.
 */
function scrollToSubmit() {
    try {
        const submitButton = document.getElementById("submitButton");

        if (!submitButton) {
            console.error("âŒ ×›×¤×ª×•×¨ ×”×©×œ×™×—×” ×œ× × ××¦× ×‘×“×£.");
            return;
        }

        submitButton.scrollIntoView({
            behavior: "smooth", // ×’×œ×™×œ×” ×—×œ×§×”
            block: "center"     // ×××•×§×“ ×‘××¨×›×– ×”××¡×š
        });

        console.log("ğŸ“ ×‘×•×¦×¢×” ×’×œ×™×œ×” ××œ ×›×¤×ª×•×¨×™ ×”×˜×•×¤×¡.");

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×’×œ×™×œ×” ××œ ×›×¤×ª×•×¨ ×”×©×œ×™×—×”:", error);
    }
}


/**
 * ğŸ”¼ scrollToTopBeforeSubmit - ××’×œ×’×œ ××ª ×”××¡×š ×œ×¨××© ×”×˜×•×¤×¡ ×œ×¤× ×™ ×©×œ×™×—×ª ×”× ×ª×•× ×™×
 *
 * ğŸ“Œ ×ª×”×œ×™×š ×”×¢×‘×•×“×”:
 * 1ï¸âƒ£ ××•×¡×™×£ ×’×œ×™×œ×” ×—×œ×§×” ×¢× CSS.
 * 2ï¸âƒ£ ××’×œ×’×œ ×œ×¨××© ×”××¡×š.
 * 3ï¸âƒ£ ×××ª×™×Ÿ ×§×œ×•×ª ×•××¤×¢×™×œ ××ª ×©×œ×™×—×ª ×”×˜×•×¤×¡.
 */
function scrollToTopBeforeSubmit() {
    try {
        console.log("ğŸ”¼ ××’×œ×’×œ ×œ×¨××© ×”×“×£ ×œ×¤× ×™ ×©×œ×™×—×”...");

        // ×’×œ×™×œ×” ×—×œ×§×” ×œ×¨××© ×”×“×£
        window.scrollTo({
            top: 0,
            behavior: "smooth"
        });

        // ×”×©×”×™×” ×§×˜× ×” ×›×“×™ ×œ××¤×©×¨ ×œ×’×œ×™×œ×” ×œ×”×ª×¨×—×© ×œ×¤× ×™ ×”×©×œ×™×—×”
        setTimeout(() => {
            submitForm(); // ×”×¤×•× ×§×¦×™×” ×”×§×™×™××ª ×©×œ×š ×œ×©××™×¨×ª ×”× ×ª×•× ×™×
        }, 400); // ××¤×©×¨ ×œ×©×—×§ ×¢× ×”×–××Ÿ ×× ×¨×•×¦×™× ×’×œ×™×œ×” ××™×˜×™×ª ×™×•×ª×¨

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×’×œ×™×œ×” ×œ×¨××© ×”×“×£:", error);
        submitForm(); // fallback
    }
}


/**
 * ×©×•×œ×— ××ª × ×ª×•× ×™ ×”×˜×•×¤×¡ ×œ×©×¨×ª ×•××¦×™×’ ×—×™×•×•×™ ×œ××©×ª××©.
 * ××—×œ×™×£ ××ª ×”×•×“×¢×ª ×”×˜×¢×™× ×” ×”×§×™×™××ª ×¢× ×—×™×•×•×™ ×¡×˜×˜×•×¡ ×ª×•×š ×›×“×™ ×•××—×¨×™ ×”×©×œ×™×—×”.
 */
function submitForm() {
    try {
        console.log("ğŸ“© ×”×ª×—×œ×ª ×©×œ×™×—×ª ×”× ×ª×•× ×™× ×œ×©×¨×ª...");
        
        // ×”×©×‘×ª×ª ×›×¤×ª×•×¨ ×”×©×œ×™×—×” ×œ×× ×™×¢×ª ×©×œ×™×—×” ×›×¤×•×œ×”
        let submitButton = document.getElementById("submitButton");
        let statusMessage = document.getElementById("loadingMessage"); // ×–×” ×”××œ×× ×˜ ×©×œ ×”×”×•×“×¢×” ××¢×œ ×”×˜×•×¤×¡

        submitButton.disabled = true;
        statusMessage.innerHTML = '<span class="spinner"></span> â³ ×©×•×œ×— × ×ª×•× ×™×... ×× × ×”××ª×Ÿ';
                statusMessage.style.display = "block"; // ××¦×™×’ ××ª ×”×”×•×“×¢×” ×‘××§×•× ×”×•×“×¢×ª ×”×˜×¢×™× ×”
        
        // ××™×¡×•×£ ×”× ×ª×•× ×™× ××”×˜×•×¤×¡
        let formData = {
  creationDate: document.getElementById("creationDate").value,
  customerID: document.getElementById("customerID").value,
  entryDate: document.getElementById("entryDate").value,
  projectID: document.getElementById("projectID").value,
  customerName: document.getElementById("customerName").value.trim(),
  taxID: document.getElementById("taxID").value.trim(),
  address: document.getElementById("address").value.trim(),
  email: document.getElementById("email").value.trim(),
  contactName: document.getElementById("contactName").value.trim(),
  contactPhone: document.getElementById("contactPhone").value.trim(),
  contactEmail: document.getElementById("contactEmail").value.trim(),
  projectName: document.getElementById("projectName").value.trim(),
  commissionRecipient: document.getElementById("commissionRecipient").value.trim(),
  commissionMonths: parseInt(document.getElementById("commissionMonths").value) || 0,
  commissionRate: parseFloat(document.getElementById("commissionRate").value) || 0
};


        console.log("ğŸ“Š × ×ª×•× ×™× ×©× ×©×œ×—×™× ×œ×©×¨×ª:", formData);

        // ×©×œ×™×—×ª ×”× ×ª×•× ×™× ×œ-Google Apps Script ×¢× Success ×•-Failure Handlers
        google.script.run
            .withSuccessHandler(formSubmissionSuccess)
            .withFailureHandler(formSubmissionFailure)
            .saveCustomerData(formData);

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×›×œ×œ×™×ª ×‘×¤×•× ×§×¦×™×” submitForm:", error);
        alert("âŒ ×©×’×™××” ×›×œ×œ×™×ª ×‘×©×œ×™×—×ª ×”× ×ª×•× ×™×. × ×¡×” ×©×•×‘.");
    }
}


/**
 * ××˜×¤×œ ×‘×ª×’×•×‘×” ××”×©×¨×ª ×œ××—×¨ ×©×œ×™×—×ª ×”× ×ª×•× ×™×.
 * ××¦×™×’ ×—×™×•×•×™ ×¡×˜×˜×•×¡ ×•××¡×™×™× ××ª ×”×¤×¢×•×œ×” ×‘×”×ª×× ×œ×ª×•×¦××” ×©×”×ª×§×‘×œ×”.
 * @param {string} result - ×”×ª×•×¦××” ×©×—×–×¨×” ××”×©×¨×ª ("success" ××• "error")
 */
function formSubmissionSuccess(result) {
    console.log("ğŸ“© ×§×™×‘×œ× ×• ×ª×©×•×‘×” ×-Google Apps Script:", result);

    let statusMessage = document.getElementById("loadingMessage"); // ×©×™××•×© ×‘××•×ª×• ××œ×× ×˜ ×©×œ ×”×˜×¢×™× ×”
    let submitButton = document.getElementById("submitButton");

    if (result === "success") {
        statusMessage.innerText = "âœ… ×”× ×ª×•× ×™× × ×©××¨×• ×‘×”×¦×œ×—×”!";
        console.log("âœ… ×”× ×ª×•× ×™× × ×©××¨×• ×‘×”×¦×œ×—×” ×‘×˜×‘×œ×”.");
        setTimeout(() => google.script.host.close(), 2000); // ×¡×’×™×¨×ª ×”×˜×•×¤×¡ ××—×¨×™ 2 ×©× ×™×•×ª
    } else {
        console.warn("âš ï¸ ×”× ×ª×•× ×™× ×œ× × ×©××¨×• ×›×”×œ×›×”, ××‘×œ × ×‘×“×•×§ ×”×× ×”×™×™×ª×” ×‘×¢×™×” ×××™×ª×™×ª.");

        if (result === null || result === undefined) {
            console.warn("âš ï¸ ×”×ª×§×‘×œ×” ×ª×’×•×‘×” ×¨×™×§×” ××”×©×¨×ª! × × ×¡×” ×œ×”×ª×¢×œ× ×× ××™×Ÿ ×©×’×™××•×ª ×‘×¨×•×¨×•×ª.");
        } else {
            statusMessage.innerText = "âŒ ×©×’×™××” ×‘×©××™×¨×ª ×”× ×ª×•× ×™×, × ×¡×” ×©×•×‘.";
            document.getElementById("submitButton").disabled = false; // ×”×¤×¢×œ×ª ×”×›×¤×ª×•×¨ ××—×“×©
        }
    }
}


/**
 * ××˜×¤×œ ×‘×›×©×œ ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª.
 * ××¦×™×’ ×”×•×“×¢×ª ×©×’×™××” ××ª××™××” ×œ××©×ª××© ×•×××¤×©×¨ × ×™×¡×™×•×Ÿ × ×•×¡×£.
 * @param {Object} error - ×”×•×“×¢×ª ×”×©×’×™××” ×©×—×–×¨×” ××”×©×¨×ª.
 */
function formSubmissionFailure(error) {
    console.error("âŒ ×›×©×œ ×‘×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª:", error);

    let statusMessage = document.getElementById("loadingMessage");
    let submitButton = document.getElementById("submitButton");

    statusMessage.innerText = "âŒ ×©×’×™××” ×‘×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª. × ×¡×” ×©×•×‘.";
    submitButton.disabled = false; // ×”×¤×¢×œ×ª ×”×›×¤×ª×•×¨ ××—×“×©
}

/**
 * ×¤×•× ×§×¦×™×” ×œ×‘×“×™×§×” ×× ×›×œ ×”×©×“×•×ª ×‘×˜×•×¤×¡ ××œ××™×
 * ×ª××¤×©×¨ ××ª ×”×›×¤×ª×•×¨ ×¨×§ ×× ×›×œ ×”×©×“×•×ª ××œ××™× ×•×©× ×”×œ×§×•×— ××™× ×• ×§×™×™×
 * @param {boolean} fromLastField - ××¦×™×™×Ÿ ×× ×”×§×¨×™××” ××’×™×¢×” ××”×©×“×” ×”××—×¨×•×Ÿ
 */
function validateForm(fromLastField = false) {
    try {
        let requiredFields = ["customerName", "taxID", "address", "email", "contactName", "contactPhone", "contactEmail", "projectName"];
        let submitButton = document.getElementById("submitButton");

        if (!submitButton) {
            console.error("âŒ ×›×¤×ª×•×¨ ×”××™×©×•×¨ ×œ× × ××¦× ×‘-DOM, ×”×‘×“×™×§×” ×œ× ×™×›×•×œ×” ×œ×”×ª×‘×¦×¢.");
            return;
        }

        // ×‘×“×™×§×” ×× ×›×œ ×”×©×“×•×ª ××œ××™×
        let isValid = requiredFields.every(id => {
            let field = document.getElementById(id);
            let value = field ? field.value.trim() : "";
            console.log(`ğŸ“‹ ×‘×“×™×§×ª ×©×“×” ${id}:`, value ? "âœ”ï¸ ××œ×" : "âŒ ×¨×™×§");
            return value !== "";
        });

        // ×× ×”×§×¨×™××” ×‘××” ××”×©×“×” ×”××—×¨×•×Ÿ ×•×”×›×œ ×ª×§×™×Ÿ - ×”×›×¤×ª×•×¨ ×™×•×¤×¢×œ ××™×“
        if (fromLastField && isValid) {
            submitButton.disabled = false;
            console.log("âœ… ×”×©×“×” ×”××—×¨×•×Ÿ ××•×œ× - ×”×›×¤×ª×•×¨ ×”×•×¤×¢×œ ××™×“!");
        } else {
            submitButton.disabled = !isValid;
        }

        console.log(`ğŸ” ×ª×•×¦××” ×¡×•×¤×™×ª ×©×œ validateForm(): ${isValid ? "âœ… ×ª×§×™×Ÿ" : "âŒ ×œ× ×ª×§×™×Ÿ"}`);
        return isValid;
    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×‘×“×™×§×ª ×ª×§×™× ×•×ª ×”×˜×•×¤×¡ validateForm():", error);
        return false;
    }
}
    </script>
</head>
<body>
  <div class="form-container">
    <h2>×¤×ª×™×—×ª ×œ×§×•×— ×—×“×©</h2>

    <!-- ğŸ”„ ×”×•×“×¢×ª ×˜×¢×™× ×” -->
    <div id="loadingMessage" class="loading-message">
      ğŸ”„ ×˜×•×¢×Ÿ × ×ª×•× ×™×... ×× × ×”××ª×Ÿ
      <span class="spinner"></span>
    </div>

    <!-- ğŸ” ×©×“×” ×¡×™×¡××” × ×¡×ª×¨ ×œ×× ×™×¢×ª ××™×œ×•×™ ××•×˜×•××˜×™ -->
    <input type="password" id="hiddenPassword">

    <!-- ğŸ“… ×©×“×•×ª ×˜×•×¤×¡ -->
    <div class="form-group"><label>×ª××¨×™×š ×™×¦×™×¨×”:</label><input type="text" id="creationDate" readonly></div>
    <div class="form-group"><label>××–×”×” ×œ×§×•×—:</label><input type="text" id="customerID" readonly></div>
    <div class="form-group"><label>×ª××¨×™×š ×›× ×™×¡×” ×œ××¢×¨×›×ª:</label><input type="text" id="entryDate" readonly></div>

    <!-- ğŸ¢ ×¤×¨×˜×™ ×œ×§×•×— -->
    <div class="form-group"><label>×©× ×œ×§×•×—:</label><input type="text" id="customerName" required></div>
    <p id="warningMessage">âš ï¸ ×œ×§×•×— ×–×” ×›×‘×¨ ×§×™×™× ×‘××¢×¨×›×ª!</p>
    <div class="form-group"><label>×—.×¤/××¡ ×¢×•×¡×§:</label><input type="text" id="taxID" maxlength="9" required></div>
    <div class="form-group"><label>×›×ª×•×‘×ª:</label><input type="text" id="address" required></div>
    <div class="form-group"><label>×“×•×"×œ:</label><input type="email" id="email" required></div>

    <!-- ğŸ“ ×¤×¨×˜×™ ××™×© ×§×©×¨ -->
    <div class="form-group"><label>×©× ××™×© ×§×©×¨:</label><input type="text" id="contactName" required></div>
    <div class="form-group"><label>×˜×œ×¤×•×Ÿ ××™×© ×§×©×¨:</label><input type="text" id="contactPhone" required></div>
    <div class="form-group"><label>×“×•×"×œ ××™×© ×§×©×¨:</label><input type="email" id="contactEmail" required></div>

    <!-- ğŸ§¾ ×¤×¨×˜×™ ×¢××œ×” -->
    <div class="form-group">
      <label>××§×‘×œ ×¢××œ×”:</label>
      <select id="commissionRecipient">
        <option value="">-- ×œ×œ× --</option>
      </select>
    </div>
    <div class="form-group">
      <label>××—×•×– ×¢××œ×”:</label>
      <input type="text" id="commissionRate" readonly>
    </div>
    <div class="form-group">
      <label>×—×•×“×©×™ ×¢××œ×”:</label>
      <input type="text" id="commissionMonths" readonly>
    </div>
    <!-- ğŸ”½ ×›×¤×ª×•×¨ ×œ×’×œ×™×œ×” ××œ ×¡×•×£ ×”×˜×•×¤×¡ -->
    <div class="form-group center-button">
    <button type="button" class="scroll-button" onclick="scrollToSubmit()">â¬‡ ×¢×‘×•×¨ ×œ×›×¤×ª×•×¨×™ ××™×©×•×¨</button>
    </div>

    <!-- ğŸ“Œ ×¤×¨×˜×™ ×¤×¨×•×™×§×˜ -->
    <h3>×¤×¨×•×™×§×˜</h3>
    <div class="form-group"><label>××–×”×” ×¤×¨×•×™×§×˜:</label><input type="text" id="projectID" readonly></div>
    <div class="form-group"><label>×©× ×”×¤×¨×•×™×§×˜:</label><input type="text" id="projectName" readonly></div>

    <!-- ğŸ›ï¸ ×›×¤×ª×•×¨×™× -->
    <div class="button-container">
      <button id="cancelButton" onclick="google.script.host.close()">×‘×™×˜×•×œ</button>
      <button id="submitButton" disabled onclick="scrollToTopBeforeSubmit()">××™×©×•×¨</button>

    </div>
  </div>
</body>
</html>
