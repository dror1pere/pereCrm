<script>

/**
 * ğŸ¨ renderField â€“ ×¤×•× ×§×¦×™×” ×©××¨× ×“×¨×ª ×©×“×” ×™×—×™×“ ×œ×˜×•×¤×¡, ×¢×œ ×¡××š ×ª×‘× ×™×ª HTML (template) ××•×’×“×¨×ª ××¨××©.
 *
 * 1ï¸âƒ£ ×‘×•×“×§×ª ×× ×§×™×™××ª ×ª×‘× ×™×ª ××ª××™××” ×œ-type ×©×œ ×”×©×“×” (`template-text`, `template-email`, `template-select` ×•×›×•').
 * 2ï¸âƒ£ ×× ×”×ª×‘× ×™×ª ×§×™×™××ª â€“ ××‘×¦×¢×ª ×”×—×œ×¤×ª ××–×”×™× ×‘×ª×•×š ×”-template (id, label, readonly).
 * 3ï¸âƒ£ ×× ×—×¡×¨×” ×ª×‘× ×™×ª â€“ ×¨×•×©××ª ××–×”×¨×” ×•××—×–×™×¨×” ××—×¨×•×–×ª ×¨×™×§×”.
 * 4ï¸âƒ£ ×”×ª×•×¦××” ×”×™× HTML ×’×•×œ××™ ×©× ×™×ª×Ÿ ×œ×”×›× ×™×¡ ×™×©×™×¨×•×ª ×œÖ¾innerHTML.
 *
 * ğŸ›‘ × ×“×¨×©×ª × ×•×›×—×•×ª ×©×œ ×”×ª×‘× ×™×•×ª ×‘×§×•×‘×¥ HTML ×”×¨××©×™ (`<script type="text/template" id="template-...">`)
 *
 * @param {Object} field - ××•×‘×™×™×§×˜ ×ª×™××•×¨ ×©×“×” ××ª×•×š ×”×¡×›××”.
 * @param {string} field.id - ××–×”×” ×™×™×—×•×“×™ ×œ×©×“×” (××©××© ×’× ×œÖ¾id ×•×œÖ¾name).
 * @param {string} field.type - ×¡×•×’ ×”×©×“×”: "text", "email", "select", ×•×›×•'.
 * @param {string} [field.label] - ×˜×§×¡×˜ ×ª×•×•×™×ª ×œ×©×“×”.
 * @param {boolean} [field.readonly] - ×”×× ×”×©×“×” ×œ×§×¨×™××” ×‘×œ×‘×“.
 * @returns {string} HTML ××•×›×Ÿ ×œ×”×¦×‘×” ×‘Ö¾DOM ××• ××—×¨×•×–×ª ×¨×™×§×” ×‘××§×¨×” ×©×œ ×›×©×œ.
 */
function renderField(field) {
  console.log(`[renderField] â–¶ ×”×ª×—×œ×ª ×¨×™× ×“×•×¨ ×©×“×”: ${field.id}, ×¡×•×’: ${field.type}`);

  try {
    // ×©×œ×‘ 1ï¸âƒ£ - ××™×ª×•×¨ ×”×ª×‘× ×™×ª ×”××ª××™××” ×œ×¡×•×’ ×”×©×“×”
    const template = document.getElementById(`template-${field.type}`);
    if (!template) {
      console.warn(`[renderField] âš ï¸ ×œ× × ××¦××” ×ª×‘× ×™×ª ×œ×¡×•×’: '${field.type}' (id: ${field.id})`);
      return "";
    }

    // ×©×œ×‘ 2ï¸âƒ£ - ×”×—×œ×¤×ª ×ª×•×•×™× ×‘×ª×‘× ×™×ª
    let html = template.innerHTML
      .replace(/{{id}}/g, field.id)
      .replace(/{{label}}/g, field.label || "")
      .replace(/{{readonly}}/g, field.readonly ? "readonly" : "");

    console.log(`[renderField] âœ… ×¨×™× ×“×•×¨ ×”×•×©×œ× ×œ×©×“×” '${field.id}'`);
    return html;

  } catch (error) {
    console.error(`[renderField] âŒ ×©×’×™××” ×›×œ×œ×™×ª ×‘×¨×™× ×“×•×¨ ×©×“×” '${field.id}':`, error);
    return "";
  }
}

</script>

<script>
/**
 * ğŸ¯ renderButton â€“ ×¤×•× ×§×¦×™×” ×œ×¨×™× ×“×•×¨ ×›×¤×ª×•×¨ HTML ×¢×œ ×‘×¡×™×¡ ×ª×‘× ×™×ª ××•×’×“×¨×ª ××¨××© (template).
 * 
 * ğŸ“Œ ×©×œ×‘×™ ×¤×¢×•×œ×”:
 * 1ï¸âƒ£ ×××ª×¨×ª ××ª ×”-template ×œ×¤×™ ×¡×•×’ ×”×›×¤×ª×•×¨ (`button-submit`, `button-cancel`, `button-custom`)
 * 2ï¸âƒ£ ××—×œ×™×¤×” ×‘×ª×•×š ×”-template ××ª ×”××©×ª× ×™× {{id}}, {{label}}, {{class}}, {{onclick}} ×‘×”×ª×× ×œ×××¤×™×™× ×™ ×”×›×¤×ª×•×¨.
 * 3ï¸âƒ£ ××—×–×™×¨×” HTML ×©× ×™×ª×Ÿ ×œ×©×œ×‘ ×™×©×™×¨×•×ª ×‘Ö¾DOM ××• ×‘Ö¾innerHTML.
 * 
 * ğŸ›‘ ×ª× ××™× ××§×“×™××™×:
 * - ×—×•×‘×” ×œ×”×’×“×™×¨ ××¨××© ××ª ×”×ª×‘× ×™×•×ª ×‘×§×•×‘×¥ ×§×•××¤×•× × ×˜×•×ª ×›×¤×ª×•×¨×™× (`<script type="text/template" id="template-button-...">`)
 * 
 * @param {Object} button - ××•×‘×™×™×§×˜ ×”×’×“×¨×” ×©×œ ×›×¤×ª×•×¨ (id, label, type, class, onclick)
 * @param {string} button.id - ××–×”×” ×™×™×—×•×“×™ ×©×œ ×”×›×¤×ª×•×¨
 * @param {string} button.label - ×˜×§×¡×˜ ×©×™×•×¤×™×¢ ×‘×›×¤×ª×•×¨
 * @param {string} button.type - ×¡×•×’ ×”×ª×‘× ×™×ª (submit, cancel, custom)
 * @param {string} [button.class] - ××—×œ×§×ª CSS (×œÖ¾custom ×‘×œ×‘×“)
 * @param {string} [button.onclick] - ×¤×•× ×§×¦×™×™×ª onclick (×œÖ¾custom ×‘×œ×‘×“)
 * @returns {string} HTML ×©×œ ×”×›×¤×ª×•×¨ ××• ××—×¨×•×–×ª ×¨×™×§×” ×‘××§×¨×” ×©×œ ×©×’×™××”
 */
function renderButton(button) {
  console.log(`[renderButton] â–¶ ×”×ª×—×œ×”: ×¡×•×’=${button.type}, id=${button.id}`);

  try {
    const templateId = `template-button-${button.type}`;
    const template = document.getElementById(templateId);

    if (!template) {
      console.warn(`[renderButton] âš ï¸ ×ª×‘× ×™×ª ×œ× × ××¦××” ×¢×‘×•×¨ ×¡×•×’ ×”×›×¤×ª×•×¨: '${button.type}'`);
      return "";
    }

    let html = template.innerHTML
      .replace(/{{id}}/g, button.id)
      .replace(/{{label}}/g, button.label || "");

    // ×˜×™×¤×•×œ ×‘Ö¾custom ×‘×œ×‘×“
    if (button.type === "custom") {
      html = html
        .replace(/{{class}}/g, button.class || "btn")
        .replace(/{{onclick}}/g, button.onclick || "");
    }

    console.log(`[renderButton] âœ… ×›×¤×ª×•×¨ '${button.id}' × ×•×¦×¨ ×‘×”×¦×œ×—×”`);
    return html;

  } catch (error) {
    console.error(`[renderButton] âŒ ×©×’×™××” ×‘×¨×™× ×“×•×¨ ×›×¤×ª×•×¨ '${button.id}':`, error);
    return "";
  }
}
</script>

<script>
/**
 * ğŸ›ï¸ renderButtonsGroup â€“ ×¤×•× ×§×¦×™×” ×©×™×•×¦×¨×ª ××ª ×§×‘×•×¦×ª ×”×›×¤×ª×•×¨×™× ×‘×ª×—×ª×™×ª ×”×˜×•×¤×¡.
 * 
 * ğŸ“Œ ×©×œ×‘×™ ×¤×¢×•×œ×”:
 * 1ï¸âƒ£ ××¨× ×“×¨×ª ×›×¤×ª×•×¨ "×‘×™×˜×•×œ" ×‘×¦×“ ×™××™×Ÿ.
 * 2ï¸âƒ£ ××¨× ×“×¨×ª ×›×¤×ª×•×¨ "××™×©×•×¨" ×‘×¦×“ ×©×××œ.
 * 3ï¸âƒ£ ×¢×•×˜×¤×ª ××ª ×©× ×™×”× ×‘×ª×•×š ××œ×× ×˜ flex.
 * 4ï¸âƒ£ ××—×–×™×¨×” HTML ×œ×”×¦×‘×” ×‘Ö¾DOM.
 *
 * ğŸ›‘ ×ª×‘× ×™×•×ª ×—×•×‘×”: template-button-submit, template-button-cancel
 *
 * @param {Object} config - ×”×’×“×¨×•×ª ×”×›×¤×ª×•×¨×™× (×¤×•× ×§×¦×™×•×ª onclick ×•×›×•').
 * @returns {string} HTML ×©×œ ×§×‘×•×¦×ª ×”×›×¤×ª×•×¨×™×.
 */
function renderButtonsGroup(config) {
  console.log("[renderButtonsGroup] â–¶ ×‘× ×™×™×ª ×›×¤×ª×•×¨×™ ×”×˜×•×¤×¡");

  try {
    const submit = renderButton({
      id: "submitButton",
      label: "××™×©×•×¨",
      type: "submit",
      onclick: config.onSubmit || "submitForm()"
    });

    const cancel = renderButton({
      id: "cancelButton",
      label: "×‘×™×˜×•×œ",
      type: "cancel",
      onclick: config.onCancel || "google.script.host.close()"
    });

    return `
      <div class="button-container">
        ${cancel}
        ${submit}
      </div>
    `;
  } catch (error) {
    console.error("[renderButtonsGroup] âŒ ×©×’×™××” ×‘×‘× ×™×™×ª ×§×‘×•×¦×ª ×›×¤×ª×•×¨×™×:", error);
    return "";
  }
}
</script>

<script>
/**
 * ğŸš€ renderForm â€“ ×¤×•× ×§×¦×™×™×ª ×¨×™× ×“×•×¨ ×˜×•×¤×¡ ×“×™× ×××™ ×œ×¤×™ ×¡×›××” ×”×›×•×œ×œ×ª ××§×˜×¢×™× (sections).
 * 
 * ğŸ“Œ ×©×œ×‘×™ ×¤×¢×•×œ×”:
 * 1ï¸âƒ£ ×××ª×¨ ××œ×× ×˜ ×™×¢×“ ×œ×¤×™ ××–×”×”.
 * 2ï¸âƒ£ ×¢×•×‘×¨ ×¢×œ ×›×œ ×”××§×˜×¢×™× (sections) ×‘×¡×›××”.
 * 3ï¸âƒ£ ×‘×›×œ ××§×˜×¢:
 *    - ××¨× ×“×¨ ×›×•×ª×¨×ª (×× ×§×™×™××ª)
 *    - ××¨× ×“×¨ ×›×œ ×©×“×” ×“×¨×š renderField ××• ×›×¤×ª×•×¨ ×“×¨×š renderButton
 * 4ï¸âƒ£ ×‘×¡×™×•× ××•×¡×™×£ ××ª ×§×‘×•×¦×ª ×›×¤×ª×•×¨×™ ×”×©×œ×™×—×”/×‘×™×˜×•×œ ×× ×œ× ×‘×•×˜×œ.
 * 
 * @param {Object} schema - ××•×‘×™×™×§×˜ ×”×¡×›××” ×”×›×•×œ×œ ×©×“×•×ª, ×¤×¢×•×œ×•×ª ×•×›×¤×ª×•×¨×™×.
 * @param {string} targetElementId - ××–×”×” ××œ×× ×˜ ×”Ö¾HTML ×©××œ×™×• ×™×¨×•× ×“×¨ ×”×˜×•×¤×¡.
 */
function renderForm(schema, targetElementId) {
  console.log("ğŸ“‹ [renderForm] â–¶ ×”×ª×—×œ×ª ×¨×™× ×“×•×¨ ×˜×•×¤×¡ ×¢× ××§×˜×¢×™×");

  try {
    const container = document.getElementById(targetElementId);
    if (!container) {
      console.error(`âŒ [renderForm] ××œ×× ×˜ ×™×¢×“ '${targetElementId}' ×œ× × ××¦×`);
      return;
    }

    if (!schema || !Array.isArray(schema.sections)) {
      console.error("âŒ [renderForm] ×¡×›××” ×œ× ×ª×§×™× ×” - ×—×¡×¨×™× sections");
      return;
    }

    container.innerHTML = ""; // × ×™×§×•×™ ×§×™×™×

    // ğŸ” ××¢×‘×¨ ×¢×œ ×›×œ ××§×˜×¢ ×‘×¡×›××”
    schema.sections.forEach((section, sectionIndex) => {
      console.log(`ğŸ“¦ [renderForm] â–¶ ××§×˜×¢ #${sectionIndex + 1}: ${section.title || "(×œ×œ× ×›×•×ª×¨×ª)"}`);

      // ğŸ·ï¸ ×”×•×¡×¤×ª ×›×•×ª×¨×ª ×× ×§×™×™××ª
      if (section.title) {
        const titleEl = document.createElement("h3");
        titleEl.textContent = section.title;
        container.appendChild(titleEl);
      }

      // ğŸ§© ×¨×™× ×“×•×¨ ×©×“×•×ª/×›×¤×ª×•×¨×™× ×‘×ª×•×š ×”××§×˜×¢
      section.fields.forEach((item, i) => {
        console.log(`ğŸ”§ [renderForm] â–¶ ×¤×¨×™×˜ #${i + 1} ×‘××§×˜×¢: id=${item.id}, type=${item.type}`);

        const isButton = item.type && item.type.startsWith("button");

        const html = isButton ? renderButton(item) : renderField(item);

        if (!html) {
          console.warn(`âš ï¸ [renderForm] ×¤×¨×™×˜ '${item.id}' ×œ× × ×¨× ×“×¨`);
          return;
        }

        const wrapper = document.createElement("div");
        wrapper.innerHTML = html;
        container.appendChild(wrapper.firstElementChild);
      });
    });

    // â• ×”×•×¡×¤×ª ×§×‘×•×¦×ª ×›×¤×ª×•×¨×™× ×¡×˜× ×“×¨×˜×™×™× ×œ×¡×™×•×
    if (schema.includeButtons !== false) {
      console.log("ğŸ›ï¸ [renderForm] â–¶ ×”×•×¡×¤×ª ×›×¤×ª×•×¨×™ ×¡×™×•× ×˜×•×¤×¡");

      const buttonsHTML = renderButtonsGroup(schema.buttonConfig || {});
      const wrapper = document.createElement("div");
      wrapper.innerHTML = buttonsHTML;
      container.appendChild(wrapper.firstElementChild);
    }

    console.log("âœ… [renderForm] â–¶ ×¡×™×•× ×¨×™× ×“×•×¨ ×˜×•×¤×¡");

  } catch (error) {
    console.error("âŒ [renderForm] ×©×’×™××” ×›×œ×œ×™×ª:", error);
  }
}
</script>
