/**
 * ×¤×•× ×§×¦×™×” 011: renderField
 *
 * ğŸ¨ ××˜×¨×”:
 * ×¨×™× ×“×•×¨ ×©×“×” ×™×—×™×“ ×œ×˜×•×¤×¡ ×¢×œ ×¡××š ×ª×‘× ×™×ª HTML ××•×›× ×” ××¨××©, ×œ×¤×™ ×”× ×ª×•× ×™× ×”××•×’×“×¨×™× ×‘×¡×›××”.
 * ×ª×•××›×ª ×‘×¨×™× ×“×•×¨ ×¡×•×’×™× ×©×•× ×™× ×©×œ ×©×“×•×ª (text, email, select ×•×›×•'), ×•××—×–×™×¨×” HTML ×’×•×œ××™ ×œ×©×™××•×©.
 *
 * ğŸ“Œ ×©×œ×‘×™ ×¤×¢×•×œ×”:
 * 1ï¸âƒ£ ××™×ª×•×¨ ×ª×‘× ×™×ª ××ª××™××” ×œ×¤×™ ×¡×•×’ ×”×©×“×” (`template-text`, `template-email` ×•×›×•').
 * 2ï¸âƒ£ ×”×—×œ×¤×ª ××–×”×™× ×‘×ª×•×š ×”Ö¾template: {{id}}, {{label}}, {{readonly}}.
 * 3ï¸âƒ£ ×”×—×–×¨×ª HTML ×’×•×œ××™ ××•×›×Ÿ ×œ×”×¦×‘×” ×‘×ª×•×š innerHTML.
 * 4ï¸âƒ£ ×‘××§×¨×” ×©×œ ×›×©×œ â€“ ×œ×•×’ ×©×’×™××” ×•×”×—×–×¨×ª ××—×¨×•×–×ª ×¨×™×§×”.
 *
 * ğŸ›‘ × ×“×¨×©×ª × ×•×›×—×•×ª ×©×œ ×ª×‘× ×™×•×ª ×‘×§×•×‘×¥ HTML ×”×¨××©×™.
 *
 * @param {Object} field - ××•×‘×™×™×§×˜ ×©×“×” ××ª×•×š ×”×¡×›××”.
 * @param {string} field.id - ××–×”×” ×™×™×—×•×“×™ ×œ×©×“×” (id ×•×œÖ¾name).
 * @param {string} field.type - ×¡×•×’ ×©×“×” ("text", "email", "select", ×•×›×•').
 * @param {string} [field.label] - ×ª×•×•×™×ª ××•×¦×’×ª ×œ×©×“×”.
 * @param {boolean} [field.readonly] - ×”×× ×”×©×“×” ×œ×§×¨×™××” ×‘×œ×‘×“.
 * 
 * @returns {string} HTML ××•×›×Ÿ ×œ×”×¦×‘×”, ××• ××—×¨×•×–×ª ×¨×™×§×” ×× ×™×© ×©×’×™××”.
 */
function renderField(field) {
  console.log(`[renderField] â–¶ ×”×ª×—×œ×ª ×¨×™× ×“×•×¨ ×©×“×”: '${field.id}', ×¡×•×’: '${field.type}'`);

  try {
    // ×©×œ×‘ 1ï¸âƒ£ â€“ ××™×ª×•×¨ ×ª×‘× ×™×ª ××ª××™××”
    const template = document.getElementById(`template-${field.type}`);
    if (!template) {
      console.warn(`âš ï¸ [renderField] ×œ× × ××¦××” ×ª×‘× ×™×ª ×œ×¡×•×’ '${field.type}' (×©×“×”: '${field.id}')`);
      return "";
    }

    // ×©×œ×‘ 2ï¸âƒ£ â€“ ×”×—×œ×¤×ª ××–×”×™× ×‘×ª×‘× ×™×ª
    let html = template.innerHTML
      .replace(/{{id}}/g, field.id)
      .replace(/{{label}}/g, field.label || "")
      .replace(/{{readonly}}/g, field.readonly ? "readonly" : "");

    // ×©×œ×‘ 3ï¸âƒ£ â€“ ×”×—×–×¨×ª HTML
    console.log(`âœ… [renderField] ×¨×™× ×“×•×¨ ×”×•×©×œ× ×œ×©×“×” '${field.id}'`);
    return html;

  } catch (error) {
    // ×©×œ×‘ 4ï¸âƒ£ â€“ ×˜×™×¤×•×œ ×‘×©×’×™××”
    console.error(`âŒ [renderField] ×©×’×™××” ×‘×¨×™× ×“×•×¨ ×©×“×” '${field.id}':`, error);
    return "";
  }
}

/**
 * ×¤×•× ×§×¦×™×” 012: renderButton
 * ×¨×™× ×“×•×¨ ×›×¤×ª×•×¨ HTML ×¢×œ ×‘×¡×™×¡ ×ª×‘× ×™×ª ××•×’×“×¨×ª ××¨××©.
 *
 * ğŸ“Œ ×©×œ×‘×™ ×¤×¢×•×œ×”:
 * 1ï¸âƒ£ ×‘× ×™×™×ª ××–×”×” ×ª×‘× ×™×ª (template ID) ×œ×¤×™ ×¡×•×’ ×”×›×¤×ª×•×¨.
 * 2ï¸âƒ£ ×˜×¢×™× ×ª ×ª×‘× ×™×ª ××ª××™××” ××”Ö¾DOM.
 * 3ï¸âƒ£ ×”×—×œ×¤×ª ××–×”×™× ×‘×ª×•×š ×”Ö¾template (id, label, class, onclick).
 * 4ï¸âƒ£ ×”×—×–×¨×ª HTML ×’×•×œ××™ ××• ××—×¨×•×–×ª ×¨×™×§×” ×‘××§×¨×” ×©×œ ×©×’×™××”.
 *
 * ğŸ›‘ × ×“×¨×©×ª × ×•×›×—×•×ª ×©×œ template ×¢× id ××ª××™×: template-button-<type>
 *
 * @param {Object} button - ××•×‘×™×™×§×˜ ×”×’×“×¨×ª ×›×¤×ª×•×¨
 * @param {string} button.id - ××–×”×” ×™×™×—×•×“×™ ×©×œ ×”×›×¤×ª×•×¨
 * @param {string} button.label - ×˜×§×¡×˜ ×©×™×•×¦×’ ×‘×›×¤×ª×•×¨
 * @param {string} button.type - ×¡×•×’ ×”×›×¤×ª×•×¨ ("submit", "cancel", "button-custom")
 * @param {string} [button.class] - ××—×œ×§×ª CSS (×¨×œ×•×•× ×˜×™ ×œÖ¾custom)
 * @param {string} [button.onclick] - ×¤×•× ×§×¦×™×™×ª onclick (×¨×œ×•×•× ×˜×™ ×œÖ¾custom)
 * @returns {string} HTML ××•×›×Ÿ ×œ×”×¦×‘×” ××• ××—×¨×•×–×ª ×¨×™×§×” ×× × ×›×©×œ
 */
function renderButton(button) {
  console.log(`[renderButton] â–¶ ×”×ª×—×œ×”: ×¡×•×’=${button.type}, id=${button.id}`);

  try {
    // 1ï¸âƒ£ ×§×‘×™×¢×ª ××–×”×” ×ª×‘× ×™×ª ×œ×¤×™ ×¡×•×’
    let templateId = `template-button-${button.type}`;
    if (button.type === "button-custom") {
      templateId = "template-button-custom";
    }

    // 2ï¸âƒ£ ××™×ª×•×¨ ×ª×‘× ×™×ª ××ª××™××”
    const template = document.getElementById(templateId);
    if (!template) {
      console.warn(`[renderButton] âš ï¸ ×ª×‘× ×™×ª ×œ× × ××¦××” ×¢×‘×•×¨ ×¡×•×’ ×”×›×¤×ª×•×¨: '${button.type}'`);
      return "";
    }

    // 3ï¸âƒ£ ×”×—×œ×¤×ª ××–×”×™× ×‘×ª×•×š ×”×ª×‘× ×™×ª
    let html = template.innerHTML
      .replace(/{{id}}/g, button.id)
      .replace(/{{label}}/g, button.label || "");

    if (button.type === "button-custom") {
      html = html
        .replace(/{{class}}/g, button.class || "btn")
        .replace(/{{onclick}}/g, button.onclick || "");
    }

    console.log(`[renderButton] âœ… ×›×¤×ª×•×¨ '${button.id}' × ×•×¦×¨ ×‘×”×¦×œ×—×”`);
    return html;

  } catch (error) {
    console.error(`[renderButton] âŒ ×©×’×™××” ×‘×¨×™× ×“×•×¨ ×›×¤×ª×•×¨ '${button.id}':`, error);
    return "";
  }
}

/**
 * ğŸš€ ×¤×•× ×§×¦×™×” 001: renderForm
 *
 * ğŸ“¦ ××˜×¨×”:
 * ×¨×™× ×“×•×¨ ×˜×•×¤×¡ ×“×™× ×××™ ××œ× ×¢×œ ×¤×™ ×¡×›××” JSON ×”×›×•×œ×œ×ª ××§×˜×¢×™×, ×©×“×•×ª ×•×›×¤×ª×•×¨×™×.
 * ×›×œ ×”×¨×›×™×‘×™× ××¨×•× ×“×¨×™× ×™×©×™×¨×•×ª ×œÖ¾form-body ×œ×œ× ×—×¨×™×’×•×ª ××• ××™×›×œ×™× ××™×•×—×“×™×.
 *
 * ğŸ“Œ ×©×œ×‘×™ ×¤×¢×•×œ×”:
 * 1ï¸âƒ£ ××™×ª×•×¨ ××œ×× ×˜ ×™×¢×“ ×œ×”×¦×’×ª ×”×˜×•×¤×¡.
 * 2ï¸âƒ£ ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×”×¡×›××”.
 * 3ï¸âƒ£ ××¢×‘×¨ ×¢×œ ×›×œ ××§×˜×¢ â€“ ×¨×™× ×“×•×¨ ×›×•×ª×¨×ª ×•×©×“×•×ª.
 * 4ï¸âƒ£ ×”×¡×ª×¨×ª ×©×›×‘×ª ×”×˜×¢×™× ×” ×¢× ×¡×™×•× ×”×¨×™× ×“×•×¨.
 *
 * ğŸ§± ×“×¨×™×©×•×ª:
 * - ×ª×‘× ×™×•×ª `template-<type>` ×§×™×™××•×ª ×‘Ö¾HTML (×œ×“×•×’××”: `template-text`, `template-button-custom`)
 *
 * @param {Object} schema - ×¡×›××” ×‘××‘× ×” JSON, ×›×•×œ×œ sections
 * @param {string} targetElementId - ××–×”×” ×”××œ×× ×˜ ×©×‘×• ×™×•×¦×’ ×”×˜×•×¤×¡ (×œ××©×œ: 'form-body')
 */
function renderForm(schema, targetElementId) {
  console.log("ğŸ“‹ [renderForm] â–¶ ×”×ª×—×œ×ª ×¨×™× ×“×•×¨ ×˜×•×¤×¡ ×¢× ××§×˜×¢×™×");

  try {
    // ×©×œ×‘ 1ï¸âƒ£ â€“ ××™×ª×•×¨ ××œ×× ×˜ ×™×¢×“
    const container = document.getElementById(targetElementId);
    if (!container) {
      console.error(`âŒ [renderForm] ××œ×× ×˜ ×™×¢×“ '${targetElementId}' ×œ× × ××¦×`);
      return;
    }

    // ×©×œ×‘ 2ï¸âƒ£ â€“ ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×¡×›××”
    if (!schema || !Array.isArray(schema.sections)) {
      console.error("âŒ [renderForm] ×¡×›××” ×œ× ×ª×§×™× ×” â€“ ×—×¡×¨×™× sections");
      return;
    }

    container.innerHTML = ""; // ××™×¤×•×¡ ×ª×•×›×Ÿ ×§×•×“×

    // ×›×•×ª×¨×ª ×“×™× ×××™×ª
    const formTitleEl = document.getElementById("form-title");
    if (formTitleEl && schema.title) {
      formTitleEl.textContent = schema.title;
      console.log(`ğŸ“› [renderForm] ×›×•×ª×¨×ª ×¢×•×“×›× ×” ×œ: '${schema.title}'`);
    }

    // ×©×œ×‘ 3ï¸âƒ£ â€“ ×¨×™× ×“×•×¨ ×›×œ ××§×˜×¢ ×‘×˜×•×¤×¡
    schema.sections.forEach((section, sectionIndex) => {
      console.log(`ğŸ“¦ [renderForm] â–¶ ××§×˜×¢ #${sectionIndex + 1}: ${section.title || "(×œ×œ× ×›×•×ª×¨×ª)"}`);

      // ×¨×™× ×“×•×¨ ×›×•×ª×¨×ª ××§×˜×¢ ×× ×§×™×™××ª
      if (section.title) {
        const titleEl = document.createElement("h3");
        titleEl.className = "section-title";
        titleEl.textContent = section.title;
        container.appendChild(titleEl);
      }

      // ×¨×™× ×“×•×¨ ×©×“×•×ª/×›×¤×ª×•×¨×™×
      section.fields.forEach((item, i) => {
        console.log(`ğŸ”§ [renderForm] â–¶ ×¤×¨×™×˜ #${i + 1}: id=${item.id}, type=${item.type}`);
        const isButton = item.type?.startsWith("button");
        const html = isButton ? renderButton(item) : renderField(item);

        if (!html) {
          console.warn(`âš ï¸ [renderForm] ×¤×¨×™×˜ '${item.id}' ×œ× × ×¨× ×“×¨`);
          return;
        }

        const wrapper = document.createElement("div");
        wrapper.innerHTML = html;
        container.appendChild(wrapper.firstElementChild);
      });
    });

    // ×©×œ×‘ 4ï¸âƒ£ â€“ ×”×¡×ª×¨×ª ×©×›×‘×ª ×˜×¢×™× ×”
    const overlay = document.getElementById("loadingOverlay");
    if (overlay) {
      overlay.style.display = "none";
      console.log("âœ… [renderForm] â–¶ ×©×›×‘×ª ×˜×¢×™× ×” ×”×•×¡×ª×¨×”");
    }

    console.log("âœ… [renderForm] â–¶ ×¡×™×•× ×¨×™× ×“×•×¨ ×˜×•×¤×¡");

  } catch (error) {
    console.error("âŒ [renderForm] ×©×’×™××” ×›×œ×œ×™×ª:", error);
  }
}



/**
 * ×¤×•× ×§×¦×™×” 001: showLoadingOverlay
 * ××¦×™×’×” ××ª ×©×›×‘×ª ×”×˜×¢×™× ×” (overlay) ××¢×œ ×”×˜×•×¤×¡.
 *
 * ğŸ“Œ ×©×œ×‘×™ ×¤×¢×•×œ×”:
 * 1ï¸âƒ£ ×××ª×¨×ª ××ª ×”××œ×× ×˜ ×¢× id="loadingOverlay"
 * 2ï¸âƒ£ ××’×“×™×¨×” display ×›Ö¾flex ×œ×¦×•×¨×š ×”×¦×’×”
 * 3ï¸âƒ£ ×¨×•×©××ª ×œ×•×’×™× ×œ××¦×™××ª ×”××œ×× ×˜ ×•×œ××¦×‘ ×”×¤×¢×•×œ×”
 */
function showLoadingOverlay() {
  console.log("ğŸŸ¡ [showLoadingOverlay] â–¶ ×× ×¡×” ×œ×”×¦×™×’ ×©×›×‘×ª ×˜×¢×™× ×”");

  try {
    const overlay = document.getElementById("loadingOverlay");

    if (!overlay) {
      console.warn("âš ï¸ [showLoadingOverlay] ××œ×× ×˜ 'loadingOverlay' ×œ× × ××¦× ×‘×“×£");
      return;
    }

    overlay.style.display = "flex";
    console.log("âœ… [showLoadingOverlay] ×©×›×‘×ª ×˜×¢×™× ×” ××•×¦×’×ª");

  } catch (error) {
    console.error("âŒ [showLoadingOverlay] ×©×’×™××” ×‘×”×¦×’×ª ×©×›×‘×ª ×˜×¢×™× ×”:", error);
  }
}

/**
 * ×¤×•× ×§×¦×™×” 002: hideLoadingOverlay
 * ××¡×ª×™×¨×” ××ª ×©×›×‘×ª ×”×˜×¢×™× ×” (overlay) ×©××›×¡×” ××ª ×”×˜×•×¤×¡.
 *
 * ğŸ“Œ ×©×œ×‘×™ ×¤×¢×•×œ×”:
 * 1ï¸âƒ£ ×××ª×¨×ª ××ª ×”××œ×× ×˜ ×¢× id="loadingOverlay"
 * 2ï¸âƒ£ ××’×“×™×¨×” display ×›Ö¾none
 * 3ï¸âƒ£ ×¨×•×©××ª ×œ×•×’×™× ×œ××¦×™××ª ×”××œ×× ×˜ ×•×œ××¦×‘ ×”×¤×¢×•×œ×”
 */
function hideLoadingOverlay() {
  console.log("ğŸŸ¡ [hideLoadingOverlay] â–¶ ×× ×¡×” ×œ×”×¡×ª×™×¨ ×©×›×‘×ª ×˜×¢×™× ×”");

  try {
    const overlay = document.getElementById("loadingOverlay");

    if (!overlay) {
      console.warn("âš ï¸ [hideLoadingOverlay] ××œ×× ×˜ 'loadingOverlay' ×œ× × ××¦× ×‘×“×£");
      return;
    }

    overlay.style.display = "none";
    console.log("âœ… [hideLoadingOverlay] ×©×›×‘×ª ×˜×¢×™× ×” ×”×•×¡×ª×¨×”");

  } catch (error) {
    console.error("âŒ [hideLoadingOverlay] ×©×’×™××” ×‘×”×¡×ª×¨×ª ×©×›×‘×ª ×˜×¢×™× ×”:", error);
  }
}
/**
 * ×¤×•× ×§×¦×™×” 003: updateLoadingOverlayText
 * 
 * ğŸ§  ××¢×“×›× ×ª ××ª ×”×˜×§×¡×˜ ×©××•×¤×™×¢ ×‘×©×›×‘×ª ×”×˜×¢×™× ×” (overlay) ×œ×¤×™ ×”×”×§×©×¨ ×”×œ×•×’×™.
 * 
 * ğŸ“Œ ×©×œ×‘×™ ×¤×¢×•×œ×”:
 * 1ï¸âƒ£ ×××ª×¨×ª ××ª ×”××œ×× ×˜ ×©××›×™×œ ××ª ×”×ª×•×›×Ÿ (`.loading-content`)
 * 2ï¸âƒ£ ××©× ×” ××ª ×”×˜×§×¡×˜ ×”×¨××©×™ (node ×”×¨××©×•×Ÿ) ×‘×”×ª×× ×œ×”×•×“×¢×”
 * 3ï¸âƒ£ ××©××™×¨×” ××ª ×”×¡×¤×™× ×¨ ×¤×¢×™×œ
 * 
 * @param {string} message - ×˜×§×¡×˜ ×©×™×•×¦×’ ×‘Ö¾overlay
 */
function updateLoadingOverlayText(message) {
  try {
    const content = document.querySelector("#loadingOverlay .loading-content");
    if (!content) {
      console.warn("âš ï¸ [updateLoadingOverlayText] ×œ× × ××¦× ×”××œ×× ×˜ '.loading-content'");
      return;
    }

    // ×¢×“×›×•×Ÿ ×”×˜×§×¡×˜ ×”×¨××©×™ â€“ childNodes[0] ×× ×™×— ×©×–×” ×˜×§×¡×˜ ×™×©×™×¨ ×œ×¤× ×™ ×”-spinner
    if (content.childNodes.length > 0) {
      content.childNodes[0].textContent = message + " ";
      console.log(`â„¹ï¸ [updateLoadingOverlayText] ×˜×§×¡×˜ ×¢×•×“×›×Ÿ ×œ: "${message}"`);
    }
  } catch (error) {
    console.error("âŒ [updateLoadingOverlayText] ×©×’×™××” ×‘×¢×“×›×•×Ÿ ×˜×§×¡×˜ overlay:", error);
  }
}
