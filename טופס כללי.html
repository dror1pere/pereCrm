<!DOCTYPE html>
<html lang="he">
  <head>
    <meta charset="UTF-8">
    <title>פרא</title>

    <!-- 🎨 עיצוב בסיסי של הטופס -->
    <style>
      <?!= include("עיצוב טופס לקוח חדש") ?>
    </style>

    <!-- 📦 סכמת JSON שנבחרה דינאמית -->
    <?!= include(dynamicSchema) ?>

    <!-- 🧠 קוד JS מרוכז -->
    <script>
      <?!= include("טעינת_סכמות") ?>
      <?!= include("בניית טופס") ?>
      <?!= include("כללי - הודעות בראש הטופס") ?>
      <?!= include("כללי - הודעות לשדה בטופס") ?>
      <?!= include("ניהול נתוני הטופס - קונטקסט + תקינות") ?>
      <?!= include("לקוח חדש - טעינת נתונים") ?>
    </script>
  </head>
  <body>

    <!-- 🧱 שלד טופס בסיסי -->
    <?!= include("שלד של טופס") ?>

    <!-- 🧩 קומפוננטות -->
    <?!= include("קומפוננטות שדות") ?>
    <?!= include("קומפוננטות כפתורים") ?>

    <!-- 🚀 הפעלת בניית הטופס + טעינת נתונים מהשרת לפי הסכמה -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const schema = loadSchemaFromDOM("schema-dynamic");

        if (!schema) {
          showGlobalErrorMessage("❌ לא ניתן לטעון את הסכמה.");
          return;
        }

        renderForm(schema, "form-body");

        // 🧠 טעינת נתונים מהשרת לפי שם הסכמה
        if (schema.title === "פתיחת לקוח חדש") {
          console.log("📡 טעינת נתונים מהשרת לטופס: לקוח חדש");

          // ⏳ הצגת overlay מקצועי עם טקסט דינאמי
          updateLoadingOverlayText("⏳ טוען נתונים מהשרת...");
          showLoadingOverlay();

          // 📡 קריאה לשרת
          google.script.run
            .withSuccessHandler(handleFormData)
            .processCustomerForm();
        }

        // בעתיד: ניתן להוסיף else if לטפסים נוספים
      });
    </script>

  </body>
</html>
