<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>×¤×ª×™×—×ª ××©×™××” ×—×“×©×”</title>
    <style>
body {
    font-family: Arial, sans-serif;
    direction: rtl;
    text-align: center;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.form-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
    width: 100%; /* â¬…ï¸ ×¢×›×©×™×• ×”×˜×•×¤×¡ ×™×ª×¤×•×¡ ××ª ×›×œ ×¨×•×—×‘ ×”×—×œ×•×Ÿ */
    max-width: 820px; /* â¬…ï¸ ××‘×˜×™×— ×©×”×ª×•×›×Ÿ ×œ× ×™×—×¨×•×’ ×××¡×›×™× ×§×˜× ×™× */
    text-align: right;
    position: relative;
    margin: auto;
}

/* âœ… ×›×œ ×”×©×“×•×ª ×™××œ××• ××ª ×›×œ ×¨×•×—×‘ ×”×˜×•×¤×¡ */
.form-container input, 
.form-container select, 
.form-container textarea {
    width: 100%; /* ×›×œ ×”×©×“×•×ª ××ª×¨×—×‘×™× ×‘×”×ª×× ×œ×’×•×“×œ ×”×˜×•×¤×¡ */
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
    appearance: none;
    background-color: white;
    cursor: pointer;
    box-sizing: border-box;
}

/* âœ… ×ª×™×§×•×Ÿ ×›×™×•×•×Ÿ ××—×–×™×§ ×”××§×•× (Placeholder) ×©×œ ××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ */
#newContactPhone {
    direction: rtl; /* ××•×•×“× ×©×”×›×™×•×•×Ÿ ×”×›×œ×œ×™ ×”×•× ××™××™×Ÿ ×œ×©×××œ */
    text-align: right; /* ××™×™×©×¨ ××ª ×›×œ ×”×ª×•×›×Ÿ ×•×’× ××ª ×”-Placeholder ×œ×™××™×Ÿ */
}

#newContactPhone::placeholder {
    text-align: right; /* ××•×•×“× ×©×”-placeholder ×’× ××•×¤×™×¢ ×‘×¦×“ ×™××™×Ÿ */
    direction: rtl;
}

/* âœ… ×ª×™×§×•×Ÿ ××—×–×™×§ ×”××§×•× (Placeholder) ×©×œ ×”×“×•×"×œ */
#newContactEmail {
    direction: ltr;
    text-align: left;
    unicode-bidi: plaintext;
}

#newContactEmail::placeholder {
    direction: rtl; /* ××‘×˜×™×— ×©×”-placeholder ×™×•×¦××“ ×œ×™××™×Ÿ */
    text-align: right; /* ××™×™×©×¨ ××ª ×”-placeholder ×œ×™××™×Ÿ */
}

/* âœ… ×”×ª×××” ××™×•×—×“×ª ×œ×©×“×” "××™×© ×§×©×¨" ×›×š ×©×”×•× ×™×¦×™×’ ××ª ×›×œ ×”× ×ª×•× ×™× ×‘×¦×•×¨×” ×‘×¨×•×¨×” */
#contactPerson {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.loading-message {
    font-size: 16px;
    color: blue;
    text-align: center;
    margin-bottom: 10px;
    display: none;
}

.form-group {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    margin-bottom: 10px;
    position: relative;
    width: 100%;
}


/* ğŸ¡ ×× ×™××¦×™×” ×œ×¡×¤×™× ×¨ */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ğŸ¡ ×¢×™×¦×•×‘ ×”×¡×¤×™× ×¨ */
.spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid black;
    border-top: 2px solid transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-left: 10px;
}


label {
    font-weight: bold;
}

select {
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="gray"><path d="M7 10l5 5 5-5z"/></svg>'); 
    background-repeat: no-repeat;
    background-position: left 10px center;
    background-size: 16px;
    padding-right: 30px;
}

.error-message {
    color: red;
    font-size: 12px;
    display: none;
    margin-top: 5px;
}

input[readonly] {
    background-color: #f0f0f0;
    cursor: not-allowed;
}

.autocomplete-suggestions {
    position: absolute;
    border: 1px solid #ccc;
    background: white;
    max-height: 150px;
    overflow-y: auto;
    width: 100%;
    z-index: 1000;
    top: 100%;
    right: 0;
    display: none;
    border-radius: 4px;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
}

.autocomplete-suggestion {
    padding: 8px;
    cursor: pointer;
}

.autocomplete-suggestion.selected, .autocomplete-suggestion:hover {
    background: #f0f0f0;
}

button {
    margin-top: 15px;
    padding: 10px;
    font-size: 14px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    width: 48%;
}

#loadingMessage {
    position: fixed; /* ×§×•×‘×¢ ×©×”×—×™×•×•×™ ×œ× ×™×–×•×– */
    top: 0; /* ×™×•×¦××“ ×œ×¨××© ×”××¡×š */
    left: 0;
    width: 100%; /* ×›×œ ×”×¨×•×—×‘ */
    background: rgba(255, 255, 0, 0.8); /* ×¨×§×¢ ×¦×”×•×‘ ×›×“×™ ×©×™×‘×œ×•×˜ */
    color: black;
    text-align: center;
    font-size: 16px;
    font-weight: bold;
    padding: 10px;
    z-index: 1000; /* ×™×‘×˜×™×— ×©×™×•×¤×™×¢ ××¢×œ ×”×›×œ */
    display: none; /* ×™×•×¤×™×¢ ×¨×§ ×›×©×¦×¨×™×š */
}


#submitButton {
    background-color: #4CAF50;
    color: white;
}

#submitButton:disabled {
    background-color: #cccccc;
}

#cancelButton {
    background-color: #f44336;
    color: white;
}

.button-container {
    display: flex;
    justify-content: space-between;
}

  </style>

    <script>
        let existingCustomers = [];
        let existingProjects = [];
        let focusedField = null; // ×©×“×” ××—×¨×•×Ÿ ×©×”×¤×•×§×•×¡ ×××•×¨ ×œ×¢×‘×•×¨ ××œ×™×•

    document.addEventListener("DOMContentLoaded", function () {
  
    disableForm();

    // âœ… ×”×›×¤×ª×•×¨ ××•×©×‘×ª ××™×“ ×¢× ×”×˜×¢×™× ×”
    let submitButton = document.getElementById("submitButton");
    submitButton.disabled = true;

    // âœ… ×˜×¢×™× ×ª ×¨×©×™××ª ×”×œ×§×•×—×•×ª
    google.script.run.withSuccessHandler(function(customers) {
        populateCustomerList(customers);
        enableForm();

         // âœ… ×”×¦×‘×ª ×¤×•×§×•×¡ ×‘×©×“×” ×”×¨××©×•×Ÿ - "×œ×§×•×—"
    let customerInput = document.getElementById("customerName");
    if (customerInput) {
        customerInput.focus();
        console.log("ğŸ“Œ ×”×¤×•×§×•×¡ ×”×•×¢×‘×¨ ×œ×©×“×” '×œ×§×•×—' ×‘×¢×ª ×˜×¢×™× ×ª ×”×˜×•×¤×¡.");
    } else {
        console.error("âŒ ×©×’×™××”: ××œ×× ×˜ 'customerName' ×œ× × ××¦× ×‘-DOM.");
    }


    }).getCustomersForProjectsForm();

    //×˜×™×¤×•×œ ×‘×©×“×” ×©× ××©×™××”  
    let taskInput = document.getElementById("taskDescription");
    let statusMessage = document.getElementById("loadingMessage"); // ×”×•×“×¢×” ×œ××©×ª××©

    if (taskInput) {

          // âœ… 1ï¸âƒ£ ×©××™×¨×ª ×”×¢×¨×š ×”×§×™×™× ×›××©×¨ ×”×©×“×” ××§×‘×œ ×¤×•×§×•×¡
        taskInput.addEventListener("focus", function () {
            previousTaskValue = this.value.trim();
            console.log(`ğŸ“Œ focus ×¢×œ ×©×“×” '××©×™××”'. ×¢×¨×š ×§×•×“×: "${previousTaskValue}"`);
        });

        taskInput.addEventListener("blur", function () {
            let taskValue = taskInput.value.trim();

               // ğŸ›‘ ×× ×”×¢×¨×š **×œ× ×”×©×ª× ×”** â†’ ×¤×©×•×˜ ×™×•×¦××™× ×œ×©×“×” ×”×‘×, ××™×Ÿ ×§×¨×™××” ×œ×©×¨×ª!
            if (taskValue === previousTaskValue) {
                console.log("â„¹ï¸ ×™×¦×™××” ××©×“×” '××©×™××”' ×œ×œ× ×©×™× ×•×™ - ××™×Ÿ ×§×¨×™××” ×œ×©×¨×ª.");
                moveToNextField(taskInput);
                return;
            }

            // âœ… ×× ×”×©×“×” ×¨×™×§ â€“ ×œ× ××‘×¦×¢×™× ×§×¨×™××” ×œ×©×¨×ª
            if (taskValue === "") {
                displayError("taskDescription", "âš ï¸ ×—×•×‘×” ×œ×”×–×™×Ÿ ×ª×™××•×¨ ××©×™××”!");
                taskInput.focus(); // âœ… ××—×–×™×¨ ××ª ×”×¤×•×§×•×¡ ×œ×©×“×” "××©×™××”"
              return  
            } else {
              hideError("taskDescription"); // âœ… ×× ×”×©×“×” ××œ×, ××¡×™×¨ ×”×•×“×¢×ª ×©×’×™××”
            }

            // ğŸ”¹ 1ï¸âƒ£ ×”×©×‘×ª×ª ×”×˜×•×¤×¡ + ×”×¦×’×ª ×”×•×“×¢×”
            resetTaskFieldsWithoutTaskName() //××™×¤×•×¡ × ×ª×•× ×™× ××•×˜×•×××˜×™×™×
            disableForm();
            statusMessage.innerText = "â³ ×˜×•×¢×Ÿ × ×ª×•× ×™×, ×× × ×”××ª×Ÿ...";
            statusMessage.style.display = "block";

            console.log("ğŸ“¡ ×©×•×œ×— ×‘×§×©×” ×œ×©×¨×ª ×œ×§×‘×œ×ª × ×ª×•× ×™× ××•×˜×•××˜×™×™× ×œ××©×™××”...");
            google.script.run
                .withSuccessHandler(function (data) {
                    handleTaskGeneratedFields(data);

                    // ğŸ”¹ 3ï¸âƒ£ ×©×—×¨×•×¨ ×”×˜×•×¤×¡ + ×”×¡×ª×¨×ª ×”×”×•×“×¢×” ××—×¨×™ ×§×‘×œ×ª ×”×ª×©×•×‘×”
                    enableForm();
                    statusMessage.style.display = "none";

                    // âœ… × ×•×¡×™×£ ×’×œ×™×œ×” ×œ×›×¤×ª×•×¨×™ ×”×©×œ×™×—×” ××—×¨×™ ×™×¦×™××” ××©×“×” "××©×™××”"
                    scrollToSubmitButton(); 
                })
                .withFailureHandler(function (error) {
                    console.error("âŒ ×©×’×™××” ×‘×§×‘×œ×ª × ×ª×•× ×™× ××”×©×¨×ª:", error);

                    // ×‘××§×¨×” ×©×œ ×©×’×™××” â€“ ×©×—×¨×•×¨ ×”×˜×•×¤×¡ + ×”×¦×’×ª ×”×•×“×¢×” ××ª××™××”
                    enableForm();
                    statusMessage.innerText = "âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×. × ×¡×” ×©×•×‘.";
                })
                .getGeneratedFields("task");
        });

        // âœ… ×××–×™×Ÿ ×—×“×©: ×›××©×¨ ×©×“×” "××©×™××”" ××ª×¨×•×§×Ÿ â€“ ×××¤×¡×™× ××ª ×”×©×“×•×ª ×”××•×˜×•××˜×™×™×
        taskInput.addEventListener("input", function () {
        let taskValue = taskInput.value.trim();

        if (taskValue === "") {
        console.warn("âš ï¸ ×”×©×“×” '××©×™××”' ×”×ª×¨×•×§×Ÿ â€“ ××™×¤×•×¡ ×©×“×•×ª ××•×˜×•××˜×™×™×.");
        resetTaskFields();
       }
    });

   }

    // âœ… ×××–×™×Ÿ ×œ×›×œ ×©×™× ×•×™ ×‘×©×“×•×ª ×›×“×™ ×œ×”×¤×¢×™×œ/×œ×”×©×‘×™×ª ××ª ×›×¤×ª×•×¨ ×”×©×œ×™×—×”
    document.querySelectorAll("input, select").forEach(input => {
        input.addEventListener("input", validateForm);
    });
});


/**
 * âœ… handleTaskGeneratedFields - ××˜×¤×œ ×‘× ×ª×•× ×™ ×”××©×™××” ×©×”×ª×§×‘×œ×• ××”×©×¨×ª ×•××¢×“×›×Ÿ ××ª ×”×©×“×•×ª ×”××•×˜×•××˜×™×™× ×‘×˜×•×¤×¡.
 *
 * ğŸ“Œ ×ª×”×œ×™×š ×”×¢×‘×•×“×”:
 * 1ï¸âƒ£ ×‘×•×“×§ ×× ×”× ×ª×•× ×™× ×”×ª×§×‘×œ×• ×›×¨××•×™.
 * 2ï¸âƒ£ ×× ××™×Ÿ × ×ª×•× ×™× â†’ ××“×¤×™×¡ ×©×’×™××” ×•×œ× ××‘×¦×¢ ×¢×“×›×•×Ÿ.
 * 3ï¸âƒ£ ×× ×”× ×ª×•× ×™× ×ª×§×™× ×™× â†’ ××¢×“×›×Ÿ ××ª ×”×©×“×•×ª ×”×‘××™×:
 *    - `creationDate` (×ª××¨×™×š ×™×¦×™×¨×ª ×©×•×¨×”)
 *    - `taskID` (××–×”×” ××©×™××”)
 *    - `entryDate` (×ª××¨×™×š ×›× ×™×¡×” ×œ××¢×¨×›×ª)
 *    - `monthEntry` (×—×•×“×© ×›× ×™×¡×”)
 *    - `yearEntry` (×©× ×ª ×›× ×™×¡×”)
 *    - `startTime` (××©×¢×”)
 * 4ï¸âƒ£ ××“×¤×™×¡ ×œ×œ×•×’ ××ª ×”× ×ª×•× ×™× ×©×”×ª×§×‘×œ×• ×œ××—×¨ ×”×¢×“×›×•×Ÿ.
 * 5ï¸âƒ£ ××‘×¦×¢ ×‘×“×™×§×ª ×˜×•×¤×¡ (`validateForm`) ×›×“×™ ×œ×”×¤×¢×™×œ ××ª ×›×¤×ª×•×¨ ×”×©×œ×™×—×” ×‘××™×“×ª ×”×¦×•×¨×š.
 *
 * @param {Object} data - ××•×‘×™×™×§×˜ ×”××›×™×œ ××ª ×”× ×ª×•× ×™× ××”×©×¨×ª.
 */
function handleTaskGeneratedFields(data) {
    try {
        console.log("ğŸ“¡ ×§×‘×œ×ª × ×ª×•× ×™× ××”×©×¨×ª:", data);

        // âœ… ×‘×“×™×§×” ×× ×”× ×ª×•× ×™× ×”×ª×§×‘×œ×• ×›×¨××•×™
        if (!data) {
            console.error("âŒ ×©×’×™××”: × ×ª×•× ×™ ×”××©×™××” ×œ× ×”×ª×§×‘×œ×• ××”×©×¨×ª.");
            return;
        }

        // ğŸ”¹ ×‘×“×™×§×” ×× ×”××œ×× ×˜×™× ×§×™×™××™× ×œ×¤× ×™ ×¢×“×›×•×Ÿ
        let creationDateField = document.getElementById("creationDate");
        let taskIDField = document.getElementById("taskID");
        let entryDateField = document.getElementById("entryDate");
        let monthEntryField = document.getElementById("monthEntry");
        let yearEntryField = document.getElementById("yearEntry");
        let startTimeField = document.getElementById("startTime");

        if (!creationDateField || !taskIDField || !entryDateField || 
            !monthEntryField || !yearEntryField || !startTimeField) {
            console.error("âŒ ×©×’×™××”: ××—×“ ××• ×™×•×ª×¨ ××”×©×“×•×ª ×”××•×˜×•××˜×™×™× ×œ× × ××¦××• ×‘-DOM.");
            return;
        }

        // âœ… ×¢×“×›×•×Ÿ ×”×©×“×•×ª ×¢× ×”× ×ª×•× ×™× ×©×”×ª×§×‘×œ×•
        creationDateField.value = data.creationDate || "";
        taskIDField.value = data.taskID || "";
        entryDateField.value = data.entryDate || "";
        monthEntryField.value = data.monthEntry || "";
        yearEntryField.value = data.yearEntry || "";
        startTimeField.value = data.startTime || "";

        console.log("âœ… ×©×“×•×ª ××•×˜×•××˜×™×™× ×¢×•×“×›× ×• ×‘×”×¦×œ×—×”:", {
            creationDate: creationDateField.value,
            taskID: taskIDField.value,
            entryDate: entryDateField.value,
            monthEntry: monthEntryField.value,
            yearEntry: yearEntryField.value,
            startTime: startTimeField.value
        });

        // âœ… ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×œ×˜×•×¤×¡
        validateForm();

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×›×œ×œ×™×ª ×‘×¤×•× ×§×¦×™×” handleTaskGeneratedFields:", error);
    }
}


function disableForm() {
            document.getElementById("loadingMessage").style.display = "block";
            document.querySelectorAll("input, button").forEach(el => el.disabled = true);
            let submitButton = document.getElementById("submitButton");
            submitButton.disabled = true;
           // submitButton.style.backgroundColor = "#ccc"; // × ×•×•×“× ×©×”×›×¤×ª×•×¨ ××¤×•×¨
        }

        // âœ… × ×—×–×™×¨ ××ª ×”×¤×•×§×•×¡ **××—×¨×™ ×©×”×©×¨×ª ×™×—×–×™×¨ × ×ª×•× ×™×**
        function enableForm() {
        document.getElementById("loadingMessage").style.display = "none";
        document.querySelectorAll("input, button").forEach(el => el.disabled = false);

      // âœ… ×× ×™×© ×©×“×” ×©×”×•×’×“×¨ ×œ×¤×•×§×•×¡ - × ×—×–×™×¨ ××œ×™×• ××ª ×”×¤×•×§×•×¡
    // âœ… × ×—×–×™×¨ ××ª ×”×¤×•×§×•×¡ **×¨×§ ×¢×›×©×™×•!**
        if (focusedField) {
        focusedField.focus();
        focusedField = null;
            }
      
            validateForm(); // âœ… ×‘×“×™×§×” ×œ××—×¨ ×˜×¢×™× ×ª × ×ª×•× ×™× ××•×˜×•××˜×™×™×
        }

     function populateCustomerList(customers) {
         if (!customers || customers.length === 0) {
             console.warn("âš ï¸ ×¨×©×™××ª ×”×œ×§×•×—×•×ª ×¨×™×§×” ××• ×œ× ×ª×§×™× ×”.");
             enableForm();
             return;
      }

            customers.sort((a, b) => a.name.trim().localeCompare(b.name.trim(), 'he', { sensitivity: 'base' }));
            existingCustomers = customers;
            console.log("âœ… ×¨×©×™××ª ×”×œ×§×•×—×•×ª × ×˜×¢× ×” ×•××•×™× ×” ×‘×¡×“×¨ ×-×‘:", existingCustomers);

            enableForm();
            attachCustomerInputEvents();
        }


 /**
 * âœ… attachCustomerInputEvents - ×”×•×¡×¤×ª ×××–×™× ×™× ×œ×©×“×” "×©× ×œ×§×•×—"
 *
 * ğŸ“Œ ×ª×”×œ×™×š ×¢×‘×•×“×”:
 * 1ï¸âƒ£ ×‘×¢×ª `focus` - × ×©××¨ ×”×¢×¨×š ×”× ×•×›×—×™ ×©×œ ×”×œ×§×•×— (`previousCustomerName`).
 * 2ï¸âƒ£ ×‘×¢×ª `blur` - ×‘×“×™×§×” ×× ×”×¢×¨×š **×‘×××ª ×”×©×ª× ×”**:
 *     - ×× ×”×¢×¨×š **×œ× ×”×©×ª× ×”** â†’ ×œ× ×§×•×¨×” ×›×œ×•×.
 *     - ×× ×”×¢×¨×š **×©×•× ×”** ××š ×§×™×™× ×‘×¨×©×™××” â†’ ×¢×“×›×•×Ÿ ×”××¢×¨×›×ª.
 *     - ×× ×”×¢×¨×š **××™× ×• ×§×™×™×** ×‘×¨×©×™××” â†’ ×”×¦×’×ª ×©×’×™××” ×•××™×¤×•×¡.
 * 3ï¸âƒ£ ×‘×¢×ª `input` - ×¢×“×›×•×Ÿ ×¨×©×™××ª ×”×”×©×œ××”.
 * 4ï¸âƒ£ ×‘×¢×ª `keydown` - ×—×¦×™× `ArrowUp/Down` + ×‘×—×™×¨×” ×¢× `Enter/Tab`.
 */
function attachCustomerInputEvents() {
    try {
        let customerInput = document.getElementById("customerName");
        let suggestionsBox = document.getElementById("customerSuggestions");

        if (!customerInput) {
            console.error("âŒ ×©×’×™××” ×§×¨×™×˜×™×ª: ×”××œ×× ×˜ 'customerName' ×œ× × ××¦×.");
            return;
        }

        let previousCustomerName = ""; // ×–×•×›×¨ ××ª ×”×¢×¨×š ×œ×¤× ×™ ×©×™× ×•×™

        console.log("ğŸ”¹ ×”×ª×—×œ×ª ×¨×™×©×•× ×××–×™× ×™× ×œ×©×“×” '×©× ×œ×§×•×—'.");

        // âœ… 1ï¸âƒ£ `focus` - ×©××™×¨×ª ×”×¢×¨×š ×”×§×•×“× ×©×œ ×”×œ×§×•×—
        customerInput.addEventListener("focus", function () {
            previousCustomerName = this.value.trim(); // ×©×•××¨ ××ª ×”×¢×¨×š ×”××§×•×¨×™
            console.log(`ğŸ“Œ ×”×¤×•×§×•×¡ × ×›× ×¡ ×œ×©×“×” '×©× ×œ×§×•×—'. ×¢×¨×š ×§×•×“×: "${previousCustomerName}"`);
            showSuggestions(this.value.trim());
        });

        // âœ… 2ï¸âƒ£ `input` - ×”×¦×’×ª ×¨×©×™××ª ×”×”×©×œ××”
        customerInput.addEventListener("input", function () {
            let value = this.value.trim();
            console.log(`âŒ¨ï¸ ×©×™× ×•×™ ×ª×•×›×Ÿ ×‘×©×“×” '×©× ×œ×§×•×—': "${value}"`);
            showSuggestions(value);
            hideError("customer");
        });

        // âœ… 3ï¸âƒ£ `keydown` - ×—×¦×™× ×œ××¢×œ×”/×œ××˜×” + ×‘×—×™×¨×” ×¢× `Enter` / `Tab`
        customerInput.addEventListener("keydown", function (event) {
    let selected = document.querySelector(".autocomplete-suggestion.selected");
    let suggestions = document.querySelectorAll(".autocomplete-suggestion");

    if (event.key === "ArrowDown") {
        event.preventDefault();
        console.log("ğŸ”½ ×—×¥ ×œ××˜×” - ××¢×‘×¨ ×œ××¤×©×¨×•×ª ×”×‘××”.");
        if (selected) {
            let next = selected.nextElementSibling;
            if (next) {
                selected.classList.remove("selected");
                next.classList.add("selected");
                next.scrollIntoView({ block: "nearest", behavior: "smooth" }); // âœ… ×’×œ×™×œ×” ×ª×§×™× ×”
            }
        } else if (suggestions.length > 0) {
            suggestions[0].classList.add("selected");
            suggestions[0].scrollIntoView({ block: "nearest", behavior: "smooth" }); // âœ… ×’×œ×™×œ×” ×ª×§×™× ×”
        }
    }

    else if (event.key === "ArrowUp") {
        event.preventDefault();
        console.log("ğŸ”¼ ×—×¥ ×œ××¢×œ×” - ××¢×‘×¨ ×œ××¤×©×¨×•×ª ×”×§×•×“××ª.");
        if (selected) {
            let prev = selected.previousElementSibling;
            if (prev) {
                selected.classList.remove("selected");
                prev.classList.add("selected");
                prev.scrollIntoView({ block: "nearest", behavior: "smooth" }); // âœ… ×’×œ×™×œ×” ×ª×§×™× ×”
            }
        }
    }

    else if (event.key === "Enter" || event.key === "Tab") {
        if (selected) {
            event.preventDefault();
            console.log(`âœ… × ×‘×—×¨ ×œ×§×•×—: ${selected.dataset.name}, ××–×”×”: ${selected.dataset.id}`);
            selectCustomer(selected.dataset.name, selected.dataset.id);
        }
    }
});

        // âœ… 4ï¸âƒ£ `blur` - ×›××©×¨ ×™×•×¦××™× ××”×©×“×”
        customerInput.addEventListener("blur", function () {
            setTimeout(() => {
                let newValue = customerInput.value.trim();
                let customerID = document.getElementById("customerID").value.trim();

                // ğŸ›‘ ×× ×”×¢×¨×š **×¨×™×§** - ××•× ×¢ ×™×¦×™××” ×•××—×–×™×¨ ×¤×•×§×•×¡
                if (newValue === "") {
                    console.warn("âš ï¸ ×”×©×“×” '×©× ×œ×§×•×—' ×¨×™×§ - ×œ× ×××¤×©×¨ ×™×¦×™××”.");
                    displayError("customer", "âš ï¸ ×™×© ×œ×”×–×™×Ÿ ×©× ×œ×§×•×—!");
                    customerInput.focus();
                    return;
                }

                // âœ… ×× ×”×¢×¨×š **×œ× ×”×©×ª× ×”** - ×œ× ×¢×•×©×™× ×›×œ×•×
                if (newValue === previousCustomerName) {
                    console.log("â„¹ï¸ ×©× ×”×œ×§×•×— ×œ× ×”×©×ª× ×” â€“ ××™×Ÿ ×¦×•×¨×š ×œ××¤×¡ ×©×“×•×ª.");
                    return;
                }

                // ğŸ” ×× ×”×¢×¨×š **×©×•× ×” ××š ×§×™×™× ×‘×¨×©×™××”** - ×”×›×œ ×ª×§×™×Ÿ
                let foundCustomer = existingCustomers.find(c => c.name === newValue);
                if (foundCustomer) {
                    console.log(`âœ… ×©× ×”×œ×§×•×— ×ª×§×£ (${newValue}), ×××©×™×›×™×.`);
                    return;
                }

                // âŒ ×× ×”×¢×¨×š **×©×•× ×” ×•×œ× ×§×™×™× ×‘×¨×©×™××”** - ×”×¦×’×ª ×©×’×™××” ×•××™×¤×•×¡
                console.warn("âš ï¸ ×©× ×œ×§×•×— ×œ× × ××¦× ×‘×¨×©×™××” - ××—×–×™×¨ ×¤×•×§×•×¡.");
                resetField(customerInput);
                displayError("customer", "âš ï¸ ×™×© ×œ×‘×—×•×¨ ×œ×§×•×— ××”×¨×©×™××”.");
                customerInput.focus();
            }, 200);
        });

        console.log("âœ… ×›×œ ×”×××–×™× ×™× ×œ×©×“×” '×©× ×œ×§×•×—' × ×•×¡×¤×• ×‘×”×¦×œ×—×”.");

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×›×œ×œ×™×ª ×‘×¤×•× ×§×¦×™×” attachCustomerInputEvents:", error);
    }
}
  
    function showSuggestions(filterText = "") {
    let suggestionsBox = document.getElementById("customerSuggestions");
    suggestionsBox.innerHTML = "";

    let filteredCustomers = existingCustomers.filter(customer =>
        customer.name.toLowerCase().includes(filterText.toLowerCase())
    );

    if (filteredCustomers.length === 0) {
        suggestionsBox.style.display = "none";
        return;
    }

    filteredCustomers.forEach((customer, index) => {
        let suggestion = document.createElement("div");
        suggestion.classList.add("autocomplete-suggestion");
        suggestion.textContent = customer.name;
        suggestion.dataset.name = customer.name;
        suggestion.dataset.id = customer.id;
        if (index === 0) {
            suggestion.classList.add("selected");
        }
        suggestion.onclick = function () {
            selectCustomer(customer.name, customer.id);
        };
        suggestionsBox.appendChild(suggestion);
    });

    suggestionsBox.style.display = "block";
}

/**
 * âœ… selectCustomer - ××˜×¤×œ ×‘×‘×—×™×¨×ª ×œ×§×•×— ××ª×•×š ×¨×©×™××ª ×”×”×©×œ××”.
 *
 * ğŸ“Œ ×ª×”×œ×™×š ×¢×‘×•×“×”:
 * 1ï¸âƒ£ ×‘×•×“×§ ×× ×”×œ×§×•×— ×©× ×‘×—×¨ ×–×”×” ×œ×œ×§×•×— ×”× ×•×›×—×™ - ×× ×›×Ÿ, ×œ× ××‘×¦×¢ ×§×¨×™××” ×œ×©×¨×ª.
 * 2ï¸âƒ£ ××¢×“×›×Ÿ ××ª ×©× ×”×œ×§×•×— ×•×”××–×”×” ×‘×©×“×•×ª ×”×˜×•×¤×¡.
 * 3ï¸âƒ£ ××¡×ª×™×¨ ×”×•×“×¢×•×ª ×©×’×™××” ×•××¡×™×¨ ××ª ×ª×™×‘×ª ×”×”×©×œ××”.
 * 4ï¸âƒ£ ××©×‘×™×ª ××ª ×”×˜×•×¤×¡ ×‘×–××Ÿ ×©×œ×™×¤×ª ×”× ×ª×•× ×™× ××”×©×¨×ª.
 * 5ï¸âƒ£ ×œ××—×¨ ×§×‘×œ×ª ×”× ×ª×•× ×™×, ××‘×¦×¢:
 *     - ×¢×™×‘×•×“ ×”× ×ª×•× ×™× ×‘- `handleCustomerData`
 *     - ×¢×“×›×•×Ÿ ×¨×©×™××ª ×”×¤×¨×•×™×§×˜×™×
 *     - ×”×•×¡×¤×ª ×××–×™× ×™× ×œ×©×“×” ×©× ×¤×¨×•×™×§×˜
 *     - ×§×‘×™×¢×ª ×¤×•×§×•×¡ ×œ×©×“×” ×”×‘×
 *
 * ğŸ›‘ ×˜×™×¤×•×œ ×‘×©×’×™××•×ª:
 * - ×‘×•×“×§ ×ª×§×™× ×•×ª ×©×œ ×”××œ×× ×˜×™× (`customerName`, `customerID`).
 * - ×‘×•×“×§ ×× ×”× ×ª×•× ×™× ×©×”×ª×§×‘×œ×• ××”×©×¨×ª ×ª×§×™× ×™×.
 * - ××ª×¢×“ ×›×œ ×©×œ×‘ ×‘×§×•× ×¡×•×œ ×›×“×™ ×œ××¤×©×¨ × ×™×˜×•×¨ ×•×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª.
 *
 * @param {string} name - ×©× ×”×œ×§×•×— ×©× ×‘×—×¨
 * @param {string} id - ××–×”×” ×”×œ×§×•×— ×©× ×‘×—×¨
 */
function selectCustomer(name, id) {
    try {
        console.log(`ğŸŸ¢ selectCustomer ×”×•×¤×¢×œ×” - × ×‘×—×¨ ×œ×§×•×—: "${name}", ××–×”×”: ${id}`);

        // ğŸ” ×©×œ×™×¤×ª ×”××œ×× ×˜×™× ××”-DOM
        let customerInput = document.getElementById("customerName");
        let customerIDInput = document.getElementById("customerID");
        let suggestionsBox = document.getElementById("customerSuggestions"); // âœ… ×”×’×“×¨×” × ×›×•× ×”

        if (!customerInput || !customerIDInput) {
            console.error("âŒ selectCustomer - ××—×“ ××”××œ×× ×˜×™× 'customerName' ××• 'customerID' ×œ× × ××¦×!");
            return;
        }

        let currentName = customerInput.value.trim();
        let currentID = customerIDInput.value.trim();

         
        // âœ… ×× ×”×©× ×•×”××–×”×” **×œ× ×”×©×ª× ×•** â€“ ×œ× × ×‘×¦×¢ ×§×¨×™××” ×œ×©×¨×ª
        if (currentName === name.trim() && currentID === id.trim()) {
            console.log("â„¹ï¸ selectCustomer - ×™×¦×™××” ×œ×œ× ×©×™× ×•×™: ××™×Ÿ ×¦×•×¨×š ×‘×§×¨×™××” ×œ×©×¨×ª.");

             // âœ… ×¡×’×™×¨×ª ×ª×™×‘×ª ×”×”×©×œ××” ×ª××™×“ ×‘×¢×ª ×™×¦×™××” ××”×©×“×”
            suggestionsBox.style.display = "none";

            // âœ… ××¢×‘×¨ ×œ×©×“×” ×”×‘× ×”×–××™×Ÿ ×‘×˜×•×¤×¡
            moveToNextField(customerInput);
            return; // âŒ ××•× ×¢ ×§×¨×™××” ××™×•×ª×¨×ª ×œ×©×¨×ª
        }

        console.log(`ğŸ”„ selectCustomer - ××¢×“×›×Ÿ ××ª ×”×œ×§×•×— ×‘×˜×•×¤×¡: "${name}" (ID: ${id})`);

        // âœ… ×¢×“×›×•×Ÿ ×©×“×•×ª ×”×œ×§×•×— ×‘×˜×•×¤×¡
        customerInput.value = name;
        customerIDInput.value = id;

        // âœ… ×”×¡×ª×¨×ª ×”×•×“×¢×ª ×©×’×™××” (×× ×”×™×™×ª×”)
        hideError("customer");

        // âœ… ×”×¡×ª×¨×ª ×ª×™×‘×ª ×”×”×©×œ××”
        document.getElementById("customerSuggestions").style.display = "none";

        resetProjectAndTaskFields(); // âœ… ×¤×•× ×§×¦×™×” ×§×™×™××ª ×©×××¤×¡×ª × ×ª×•× ×™ ×¤×¨×•×™×§×˜
        
        // ğŸ›‘ ×”×©×‘×ª×ª ×”×˜×•×¤×¡ ×‘××”×œ×š ×˜×¢×™× ×ª ×”× ×ª×•× ×™×
        console.log("â³ selectCustomer - ××©×‘×™×ª ××ª ×”×˜×•×¤×¡ ×‘×–××Ÿ ×©×œ×™×¤×ª ×”× ×ª×•× ×™×...");
        disableForm();

        // ğŸš€ ×§×¨×™××” ×œ×©×¨×ª ×œ×§×‘×œ×ª × ×ª×•× ×™ ×”×œ×§×•×—
        google.script.run
            .withSuccessHandler(function (data) {
                try {
                    console.log("ğŸ“¡ selectCustomer - × ×ª×•× ×™ ×œ×§×•×— ×©×”×ª×§×‘×œ×• ××”×©×¨×ª:", data);

                    if (!data) {
                        console.error("âŒ selectCustomer - ×”× ×ª×•× ×™× ×©×”×ª×§×‘×œ×• ××”×©×¨×ª ×¨×™×§×™×!");
                        enableForm();
                        return;
                    }

                    // âœ… ×¢×™×‘×•×“ × ×ª×•× ×™ ×”×œ×§×•×—
                    handleCustomerData(data);

                    // âœ… ×”×•×¡×¤×ª ×”××–× ×•×ª ×œ×©×“×” "×©× ×¤×¨×•×™×§×˜" (×œ××—×¨ ×˜×¢×™× ×ª ×”× ×ª×•× ×™×)
                    addProjectNameListeners();

                    // âœ… ××¢×‘×¨ ×œ×©×“×” ×”×‘× ×”×–××™×Ÿ ×‘×˜×•×¤×¡
                    moveToNextField(customerInput);

                    console.log("âœ… selectCustomer - ×¢×“×›×•×Ÿ ×”× ×ª×•× ×™× ×”×•×©×œ× ×‘×”×¦×œ×—×”!");

                } catch (error) {
                    console.error("âŒ selectCustomer - ×©×’×™××” ×‘×¢×ª ×¢×™×‘×•×“ ×”× ×ª×•× ×™× ×©×”×ª×§×‘×œ×•:", error);
                    enableForm();
                }
            })
            .withFailureHandler(function (error) {
                console.error("âŒ selectCustomer - ×›×©×œ ×‘×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª:", error);
                alert("âŒ ×©×’×™××” ×‘×©×œ×™×¤×ª × ×ª×•× ×™ ×”×œ×§×•×—. × ×¡×” ×©×•×‘.");
                enableForm();
            })
            .getCustomerData(id);

    } catch (error) {
        console.error("âŒ selectCustomer - ×©×’×™××” ×›×œ×œ×™×ª ×‘×¤×•× ×§×¦×™×”:", error);
    }
}


/**
 * ×××–×™× ×” ×œ×©×™× ×•×™×™× ×‘×©×“×” "×©× ×¤×¨×•×™×§×˜" ×•××•×•×“××ª ×©××™×Ÿ ×›×¤×™×œ×•×ª.
 * 
 * ğŸš€ ×ª×”×œ×™×š ×”×¢×‘×•×“×”:
 * 1. ×××–×™× ×” ×œ×”×§×œ×“×” ×‘×©×“×” "×©× ×¤×¨×•×™×§×˜" ×•××–×”×” ×× ×”×©× ×›×‘×¨ ×§×™×™× ×‘×¨×©×™××ª ×”×¤×¨×•×™×§×˜×™× ×©×œ ×”×œ×§×•×—.
 * 2. ×× ×©× ×”×¤×¨×•×™×§×˜ ×§×™×™× â†’ ×ª×•×¦×’ ×”×•×“×¢×ª ×©×’×™××”, ×•×”×©×“×” ×™×¡×•××Ÿ ×¢× `data-duplicate="true"`.
 * 3. ×× ×©× ×”×¤×¨×•×™×§×˜ ×œ× ×§×™×™× â†’ ×ª×•×¡×¨ ×”×•×“×¢×ª ×”×©×’×™××”, ×•×”×©×“×” ×™×¡×•××Ÿ ×¢× `data-duplicate="false"`.
 * 4. ×××–×™× ×” ×œ× ×™×¡×™×•×Ÿ ×™×¦×™××” ××”×©×“×” (Tab ××• ×œ×—×™×¦×” ××—×•×¥ ×œ×©×“×”).
 *    - ×× ×™×© ×›×¤×™×œ×•×ª â†’ ××•× ×¢×ª ×™×¦×™××” ×•××—×–×™×¨×” ××ª ×”×¤×•×§×•×¡ ×œ×©×“×”.
 *    - ×× ××™×Ÿ ×›×¤×™×œ×•×ª â†’ ×××¤×©×¨×ª ××¢×‘×¨ ×œ×©×“×” ×”×‘×.
 */
function addProjectNameListeners() {
    try {
        let projectInput = document.getElementById("projectName");

        if (!projectInput) {
            console.error("âŒ ×©×’×™××”: ×œ× × ××¦× ××œ×× ×˜ ×‘×©× projectName!");
            return;
        }

        console.log("ğŸ”¹ ×××–×™× ×™× × ×•×¡×¤×• ×œ×©×“×” '×©× ×¤×¨×•×™×§×˜'.");

        projectInput.addEventListener("blur", function () {
    let projectName = projectInput.value.trim();

    if (projectName === "") {  
        console.warn("âš ï¸ ×—×•×‘×” ×œ×‘×—×•×¨ ×¤×¨×•×™×§×˜ ××”×¨×©×™××”!");
        displayError("project", "âš ï¸ ×™×© ×œ×‘×—×•×¨ ×¤×¨×•×™×§×˜.");
        projectInput.focus(); // âŒ ×œ× ×××¤×©×¨ ×™×¦×™××” ×× ×”×©×“×” ×¨×™×§
    } else {
        hideError("project");
    }
});

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×›×œ×œ×™×ª ×‘×¤×•× ×§×¦×™×” addProjectNameListeners:", error);
    }
}

function moveToNextField(currentField) {
    let formElements = Array.from(document.querySelectorAll("input, select, button"));
    let currentIndex = formElements.indexOf(currentField);

    do {
        currentIndex++;
    } while (currentIndex < formElements.length && formElements[currentIndex].readOnly);

    if (currentIndex < formElements.length) {
        formElements[currentIndex].focus();
    }
}

// âœ… ×¤×•× ×§×¦×™×” ×©××—×–×™×¨×” ××ª ×”×©×“×” ×”×‘× ×”×¤×ª×•×— ×œ×”×§×œ×“×”
function getNextField(currentField) {
    let formElements = Array.from(document.querySelectorAll("input:not([readonly]), select, button"));
    let currentIndex = formElements.indexOf(currentField);

    if (currentIndex >= 0 && currentIndex < formElements.length - 1) {
        return formElements[currentIndex + 1]; // ××—×–×™×¨×” ××ª ×”×©×“×” ×”×‘×
    }
    return null;
}

function handleCustomerData(data) {
    if (!data) {
        console.error("âŒ ×©×’×™××”: ×œ× ×”×ª×§×‘×œ×• × ×ª×•× ×™ ×œ×§×•×—.");
        return;
    }

    // âœ… ××•×›×œ×¡ ×ª×¤×¨×™×˜ ×”×‘×—×™×¨×” ×©×œ ×”×¤×¨×•×™×§×˜×™× ×‘×˜×•×¤×¡
    populateProjectDropdown(data.projects);

    enableForm();
}

/**
 * ğŸš€ populateProjectDropdown - ×××›×œ×¡×ª ××ª ×”×¨×©×™××” ×”× ×¤×ª×—×ª ×©×œ ×”×¤×¨×•×™×§×˜×™× ×‘×˜×•×¤×¡ "×¤×¢×™×œ×•×ª ×—×“×©×”"
 *
 * ğŸ“Œ ×ª×”×œ×™×š ×”×¢×‘×•×“×”:
 * 1ï¸âƒ£ ××™×¤×•×¡ ×”×¨×©×™××” ×”×§×™×™××ª (××—×™×§×ª ××¤×©×¨×•×™×•×ª ×§×•×“××•×ª).
 * 2ï¸âƒ£ ×™×¦×™×¨×ª ××¤×©×¨×•×™×•×ª (`<option>`) ××ª×•×š ×”××¢×¨×š `projects` ×©×”×ª×§×‘×œ ××”×©×¨×ª.
 * 3ï¸âƒ£ ×”×•×¡×¤×ª ××–×”×” ×”×¤×¨×•×™×§×˜, ××™×© ×”×§×©×¨ ×•×œ×™× ×§ ×œ×¨×™×©×•× ×”×¤×¢×™×œ×•×ª ×œ×›×œ ××¤×©×¨×•×ª (`data-*` attributes).
 * 4ï¸âƒ£ ×”×•×¡×¤×ª ×××–×™×Ÿ ×œ××™×¨×•×¢ ×©×™× ×•×™ (`change`):
 *    - ×›××©×¨ ××©×ª××© ×‘×•×—×¨ ×¤×¨×•×™×§×˜:
 *      âœ… ××–×”×” ×”×¤×¨×•×™×§×˜ ×™×•×¦×‘ ×‘×©×“×” `projectID`.
 *      âœ… ×©× ××™×© ×”×§×©×¨ ×™×•×¦×‘ ×‘×©×“×” `contactPerson`.
 *      âœ… ×”×œ×™× ×§ ×œ×§×•×‘×¥ ×¨×™×©×•× ×”×¤×¢×™×œ×•×ª ×™×•×¦×‘ ×‘×©×“×” `activityLogLink`.
 *    - ×× ××™×Ÿ ×‘×—×™×¨×” â†’ ×›×œ ×”×©×“×•×ª ×™××•×¤×¡×•.
 *
 * @param {Array} projects - ××¢×¨×š ×©×œ ××•×‘×™×™×§×˜×™× ×”××›×™×œ×™× ××™×“×¢ ×¢×œ ×”×¤×¨×•×™×§×˜×™×.
 *                           ×›×œ ××•×‘×™×™×§×˜ ××›×™×œ:
 *                           - `projectID` (string) - ××–×”×” ×”×¤×¨×•×™×§×˜.
 *                           - `projectName` (string) - ×©× ×”×¤×¨×•×™×§×˜.
 *                           - `contactPerson` (string) - ×©× ××™×© ×”×§×©×¨ ×”××©×•×™×š ×œ×¤×¨×•×™×§×˜.
 *                           - `activityLogLink` (string) - ×œ×™× ×§ ×œ××¡××š DOCS ×¢× ×¨×™×©×•× ×”×¤×¢×™×œ×•×ª ×©×œ ×”×¤×¨×•×™×§×˜.
 */
function populateProjectDropdown(projects) {
    let projectSelect = document.getElementById("projectName");

    // âŒ ×‘×“×™×§×” ×× ×”××œ×× ×˜ ×§×™×™× ×‘-DOM, ×× ×œ× - ×”×¦×’×ª ×©×’×™××”
    if (!projectSelect) {
        console.error("âŒ ×©×’×™××”: ×œ× × ××¦× ××œ×× ×˜ ×‘×©× 'projectName'.");
        return;
    }

    // ğŸ”¹ 1ï¸âƒ£ ××™×¤×•×¡ ×”×¨×©×™××” ×”×§×™×™××ª (×”×›× ×¡×ª ××¤×©×¨×•×ª ×‘×¨×™×¨×ª ××—×“×œ)
    projectSelect.innerHTML = '<option value="">×‘×—×¨ ×¤×¨×•×™×§×˜...</option>';

    // ğŸ”¹ 2ï¸âƒ£ ×™×¦×™×¨×ª ××¤×©×¨×•×™×•×ª ×—×“×©×•×ª ×œ×¤×™ ×”× ×ª×•× ×™× ×©×”×ª×§×‘×œ×•
    projects.forEach(project => {
        let option = document.createElement("option");
        option.value = project.projectName;
        option.textContent = project.projectName;

        // âœ… ×©××™×¨×ª ×”× ×ª×•× ×™× ×›×××¤×™×™× ×™× `data-*` ×œ×›×œ ××¤×©×¨×•×ª
        option.dataset.projectId = project.projectID; // ××–×”×” ×”×¤×¨×•×™×§×˜
        option.dataset.contactPerson = project.contactPerson || "×œ×œ× ××™×© ×§×©×¨"; // ××™×© ×”×§×©×¨ ×”××©×•×™×š ×œ×¤×¨×•×™×§×˜
        option.dataset.activityLogLink = project.activityLogLink || ""; // ×œ×™× ×§ ×œ×¨×™×©×•× ×”×¤×¢×™×œ×•×ª

        projectSelect.appendChild(option);
    });

    /**
     * ğŸ”¹ 3ï¸âƒ£ ×××–×™×Ÿ ×œ×©×™× ×•×™ ×‘×‘×—×™×¨×ª ×¤×¨×•×™×§×˜
     *    - ×›××©×¨ ××©×ª××© ×‘×•×—×¨ ×¤×¨×•×™×§×˜ â†’ ×”× ×ª×•× ×™× ××ª×¢×“×›× ×™× ×‘×˜×•×¤×¡.
     *    - ×× ××™×Ÿ ×‘×—×™×¨×” â†’ ×›×œ ×”×©×“×•×ª ×™××•×¤×¡×•.
     */
    projectSelect.addEventListener("change", function () {
        let selectedOption = projectSelect.options[projectSelect.selectedIndex];

        if (selectedOption.value) {
            // âœ… ×¢×“×›×•×Ÿ ×”×©×“×•×ª ×‘×˜×•×¤×¡
            document.getElementById("projectID").value = selectedOption.dataset.projectId;
            document.getElementById("contactPerson").value = selectedOption.dataset.contactPerson;
            document.getElementById("activityLogLink").value = selectedOption.dataset.activityLogLink; // ×¢×“×›×•×Ÿ ×©×“×” ×”×œ×™× ×§

            console.log(`ğŸ“Œ × ×‘×—×¨ ×¤×¨×•×™×§×˜: ${selectedOption.value}, ××–×”×”: ${selectedOption.dataset.projectId}, ××™×© ×§×©×¨: ${selectedOption.dataset.contactPerson}, ×œ×•×’ ×¤×¢×™×œ×•×ª: ${selectedOption.dataset.activityLogLink}`);

            // âœ… ××™×¤×•×¡ ×©×“×•×ª ×”××©×™××” ×›××©×¨ ×”×¤×¨×•×™×§×˜ ××©×ª× ×”
            resetTaskFields();

            // âœ… ××¢×‘×¨ ××•×˜×•××˜×™ ×œ×©×“×” ×”×‘×
            moveToNextField(this);
        } else {
            // âŒ ×× ××™×Ÿ ×‘×—×™×¨×” - ×××¤×¡×™× ××ª ×›×œ ×”×©×“×•×ª ×”×¨×œ×•×•× ×˜×™×™×
            document.getElementById("projectID").value = "";
            document.getElementById("contactPerson").value = "";
            document.getElementById("activityLogLink").value = ""; // ××™×¤×•×¡ ×”×œ×™× ×§
        }
    });
}


function displayError(field, message) {
    let errorElement = document.getElementById(`${field}Error`);
    if (errorElement) {
        errorElement.textContent = message;
        errorElement.style.display = "block";
    } else {
        console.warn(`âš ï¸ ××œ×× ×˜ ×”×©×’×™××” ×œ× × ××¦× ×¢×‘×•×¨ ×”×©×“×”: ${field}`);
    }
}

function hideError(field) {
    let errorElement = document.getElementById(`${field}Error`);
    if (errorElement) {
        errorElement.textContent = "";
        errorElement.style.display = "none";
    }
}

function resetField(field) {
  field.value = "";
  showSuggestions("");
  field.focus();
}

/**
 * ğŸš€ validateForm - ×¤×•× ×§×¦×™×” ×œ×‘×“×™×§×” ×× ×›×œ ×ª× ××™ ×”×˜×•×¤×¡ ××•×œ××• ×›×“×™ ×œ××¤×©×¨ ×©×œ×™×—×”.
 *
 * ğŸ” ×ª×”×œ×™×š ×”×¢×‘×•×“×”:
 * 1ï¸âƒ£ ×‘×•×“×§×ª ×©×›×œ ×”×©×“×•×ª ×”×—×™×•× ×™×™× ××œ××™× (×œ×¤×™ ×”×¨×©×™××” `requiredFields`).
 * 2ï¸âƒ£ ××•×•×“××ª ×©×©×“×” "××™×© ×§×©×¨" ×œ× × ×©××¨ ×¢× ×¢×¨×š ×‘×¨×™×¨×ª ××—×“×œ.
 * 3ï¸âƒ£ ×× ×™×© ×©×“×” ×—×¡×¨, ×ª×•×¦×’ ×”×•×“×¢×ª ×©×’×™××” ×¨×œ×•×•× ×˜×™×ª ×•×”×©×“×” ×™×¡×•××Ÿ.
 * 4ï¸âƒ£ ×× ×›×œ ×”× ×ª×•× ×™× ×ª×§×™× ×™× â†’ ×›×¤×ª×•×¨ ×”×©×œ×™×—×” ×™×•×¤×¢×œ âœ….
 * 5ï¸âƒ£ ×× ×™×© ×—×•×¡×¨×™× â†’ ×›×¤×ª×•×¨ ×”×©×œ×™×—×” ×™×™×©××¨ ××•×©×‘×ª âŒ.
 *
 * ğŸ›‘ ×˜×™×¤×•×œ ×‘×©×’×™××•×ª:
 * - ×× ××œ×× ×˜ ×œ× × ××¦× ×‘-DOM â†’ ×ª×•×“×¤×¡ ×©×’×™××” `console.error()`.
 * - ×›×œ ×©×“×” ×—×¡×¨ â†’ ×”×•×“×¢×ª ×©×’×™××” ×ª×•×¦×’ ×¢× `displayError()`.
 * - ×”×•×“×¢×•×ª ×©×’×™××” ×™×©× ×•×ª ×× ×•×§×•×ª ×œ×¤× ×™ ×”×‘×“×™×§×” ×›×“×™ ×œ×× ×•×¢ ×”×¦×˜×‘×¨×•×ª ×©×’×™××•×ª.
 */
function validateForm() {
    try {
        console.log("ğŸ” ×”×ª×—×œ×ª ×‘×“×™×§×ª ×”×˜×•×¤×¡...");

        // âœ… ×¨×©×™××ª ×”×©×“×•×ª ×”×—×™×•× ×™×™× ×©×¦×¨×™×›×™× ×œ×”×™×•×ª ××œ××™×
        let requiredFields = [
            { id: "customerName", label: "×©× ×œ×§×•×—" },
            { id: "customerID", label: "××–×”×” ×œ×§×•×—" },
            { id: "projectName", label: "×©× ×¤×¨×•×™×§×˜" },
            { id: "creationDate", label: "×ª××¨×™×š ×™×¦×™×¨×”" },
            { id: "entryDate", label: "×ª××¨×™×š ×›× ×™×¡×” ×œ××¢×¨×›×ª" },
            { id: "projectID", label: "××–×”×” ×¤×¨×•×™×§×˜" },
            { id: "taskDescription", label: "×ª×™××•×¨ ××©×™××”" }, // âœ… ×©×“×” ××©×™××” × ×•×¡×£ ×œ×¨×©×™××”
            { id: "taskID", label: "××–×”×” ××©×™××”" },
            { id: "monthEntry", label: "×—×•×“×© ×›× ×™×¡×”" },
            { id: "yearEntry", label: "×©× ×ª ×›× ×™×¡×”" },
            { id: "startTime", label: "××©×¢×”" }
        ];

        let submitButton = document.getElementById("submitButton");
        let contactPerson = document.getElementById("contactPerson"); // ğŸ“Œ ×©×“×” "××™×© ×§×©×¨"
        let allFieldsFilled = true;

        console.log("ğŸ“œ ×‘×“×™×§×” ×©×›×œ ×”×©×“×•×ª ×”×—×™×•× ×™×™× ××œ××™×...");

        // ğŸ”¹ × ×™×§×•×™ ×”×•×“×¢×•×ª ×©×’×™××” ×™×©× ×•×ª
        requiredFields.forEach(field => hideError(field.id));
        hideError("contactPerson"); // ××—×™×§×ª ×©×’×™××” ×™×©× ×” ×’× ××©×“×” "××™×© ×§×©×¨"

        // ğŸ”¹ ×‘×“×™×§×” ×©×›×œ ×”×©×“×•×ª ×”×¨×’×™×œ×™× ××œ××™×
        for (let field of requiredFields) {
            let element = document.getElementById(field.id);
            if (!element) {
                console.error(`âŒ ×©×’×™××” ×§×¨×™×˜×™×ª: ×”××œ×× ×˜ ${field.id} ×œ× × ××¦× ×‘-DOM!`);
                continue; // ×××©×™×›×™× ×œ×‘×“×™×§×” ×”×‘××”
            }

            let value = element.value.trim();
            console.log(`ğŸ”¹ ×‘×“×™×§×ª ×©×“×” "${field.label}":`, value);

            if (value === "") {
                allFieldsFilled = false;
                displayError(field.id, `âš ï¸ ${field.label} ×”×•× ×©×“×” ×—×•×‘×”!`);
                console.warn(`âš ï¸ ×”×©×“×” "${field.label}" ×¨×™×§ - ×˜×•×¤×¡ ×œ× ×ª×§×™×Ÿ.`);
            }
        }

        // ğŸ”¹ ×‘×“×™×§×” ××™×•×—×“×ª ×œ×©×“×” "××™×© ×§×©×¨"
        if (contactPerson) {
            let contactValue = contactPerson.value.trim();
            console.log(`ğŸ”¹ ×‘×“×™×§×ª ×©×“×” "××™×© ×§×©×¨":`, contactValue);

            if (contactValue === "" || contactValue === "×‘×—×¨ ××™×© ×§×©×¨...") {
                allFieldsFilled = false;
                displayError("contactPerson", "âš ï¸ ×™×© ×œ×‘×—×•×¨ ××™×© ×§×©×¨!");
                console.warn(`âš ï¸ ××™×© ×§×©×¨ ×œ× × ×‘×—×¨ - ×˜×•×¤×¡ ×œ× ×ª×§×™×Ÿ.`);
            }
        } else {
            console.error("âŒ ×©×’×™××” ×§×¨×™×˜×™×ª: ××œ×× ×˜ 'contactPerson' ×œ× × ××¦×!");
        }

        // ğŸ”¹ ×”×¤×¢×œ×ª ××• ×”×©×‘×ª×ª ×›×¤×ª×•×¨ ×”×©×œ×™×—×”
        if (allFieldsFilled) {
            submitButton.disabled = false;
            console.log("âœ… ×›×œ ×”×©×“×•×ª ××œ××™×, ×›×¤×ª×•×¨ '××™×©×•×¨' ×”×•×¤×¢×œ.");
        } else {
            submitButton.disabled = true;
            console.warn("âš ï¸ ×—×œ×§ ××”×©×“×•×ª ×—×¡×¨×™× ××• ×œ× ×ª×§×™× ×™×, ×›×¤×ª×•×¨ '××™×©×•×¨' × ×©××¨ ××•×©×‘×ª.");
        }

        console.log("ğŸ” ×¡×™×•× ×‘×“×™×§×ª ×”×˜×•×¤×¡.");

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×›×œ×œ×™×ª ×‘×¤×•× ×§×¦×™×” validateForm:", error);
    }
}


/**
 * âœ… resetTaskFields - ×××¤×¡ ××ª ×”×©×“×•×ª ×”××•×˜×•××˜×™×™× ×©×œ ×”××©×™××”.
 *
 * ğŸ“Œ ×ª×”×œ×™×š ×”×¢×‘×•×“×”:
 * 1ï¸âƒ£ ×××¤×¡ ××ª ×”×©×“×•×ª ×”×‘××™× ×›××©×¨ ×œ×§×•×— ××• ×¤×¨×•×™×§×˜ ××ª×—×œ×¤×™×:
 *    - `taskDescription` (×ª×™××•×¨ ××©×™××”)
 *    - `creationDate` (×ª××¨×™×š ×™×¦×™×¨×ª ×©×•×¨×”)
 *    - `taskID` (××–×”×” ××©×™××”)
 *    - `entryDate` (×ª××¨×™×š ×›× ×™×¡×” ×œ××¢×¨×›×ª)
 *    - `monthEntry` (×—×•×“×© ×›× ×™×¡×”)
 *    - `yearEntry` (×©× ×ª ×›× ×™×¡×”)
 *    - `startTime` (××©×¢×”)
 * 2ï¸âƒ£ ××“×¤×™×¡ ×œ×œ×•×’ ×”×•×“×¢×” ×¢×œ ×”××™×¤×•×¡.
 */
function resetTaskFields() {
    try {
        console.log("ğŸ”„ ×××¤×¡ ××ª ×”×©×“×•×ª ×”××•×˜×•××˜×™×™× ×©×œ ×”××©×™××”...");

        document.getElementById("taskDescription").value = ""; // âœ… ××™×¤×•×¡ ×©× ×”××©×™××”
        document.getElementById("creationDate").value = "";
        document.getElementById("taskID").value = "";
        document.getElementById("entryDate").value = "";
        document.getElementById("monthEntry").value = "";
        document.getElementById("yearEntry").value = "";
        document.getElementById("startTime").value = "";

        console.log("âœ… ×›×œ ×”×©×“×•×ª ×©×œ ×”××©×™××” ××•×¤×¡×• ×‘×”×¦×œ×—×”.");

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘××™×¤×•×¡ ×”×©×“×•×ª ×”××•×˜×•××˜×™×™×:", error);
    }
}


function resetTaskFieldsWithoutTaskName() {
    try {
        console.log("ğŸ”„ ×××¤×¡ ××ª ×”×©×“×•×ª ×”××•×˜×•××˜×™×™× ×©×œ ×”××©×™××”...");

        document.getElementById("creationDate").value = "";
        document.getElementById("taskID").value = "";
        document.getElementById("entryDate").value = "";
        document.getElementById("monthEntry").value = "";
        document.getElementById("yearEntry").value = "";
        document.getElementById("startTime").value = "";

        console.log("âœ… ×›×œ ×”×©×“×•×ª ×©×œ ×”××©×™××” ××•×¤×¡×• ×‘×”×¦×œ×—×”.");

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘××™×¤×•×¡ ×”×©×“×•×ª ×”××•×˜×•××˜×™×™×:", error);
    }
}




/**
 * âœ… function resetProjectAndTaskFields() {
 - ×××¤×¡ ××ª ×›×œ ×”×©×“×•×ª ×‘×˜×•×¤×¡ ×‘×¢×ª ×©×™× ×•×™ ××• ××—×™×§×” ×©×œ ×©×“×” ×”×œ×§×•×—.
 *
 * ğŸ“Œ ×ª×”×œ×™×š ×”×¢×‘×•×“×”:
 * 1ï¸âƒ£ ×××¤×¡ ××ª ×›×œ ×”×©×“×•×ª ×‘×˜×•×¤×¡, ×›×•×œ×œ:
 *    - ×¤×¨×˜×™ ×”×œ×§×•×— (`customerName`, `customerID`)
 *    - ×¤×¨×˜×™ ×”×¤×¨×•×™×§×˜ (`projectName`, `projectID`, `contactPerson`, `activityLogLink`)
 *    - × ×ª×•× ×™ ×”××©×™××” - ×‘×××¦×¢×•×ª `resetTaskFields()`
 * 2ï¸âƒ£ ×× ×§×” ×”×•×“×¢×•×ª ×©×’×™××” ×× ×§×™×™××•×ª.
 * 3ï¸âƒ£ ××‘×¦×¢ ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×œ×˜×•×¤×¡ (`validateForm`) ×›×“×™ ×œ×”×©×‘×™×ª ××ª ×›×¤×ª×•×¨ ×”×©×œ×™×—×”.
 */
function resetProjectAndTaskFields() {
    try {
        console.log("ğŸ”„ ×××¤×¡ ××ª ×›×œ ×”×©×“×•×ª ×‘×˜×•×¤×¡...");

        // âœ… ××™×¤×•×¡ ×©×“×•×ª ×”×¤×¨×•×™×§×˜
        document.getElementById("projectName").value = "";
        document.getElementById("projectID").value = "";
        document.getElementById("contactPerson").value = "";
        document.getElementById("activityLogLink").value = "";

        // âœ… ××™×¤×•×¡ ×©×“×•×ª ×”××©×™××” ×‘×××¦×¢×•×ª ×”×¤×•× ×§×¦×™×” ×”×§×™×™××ª
        resetTaskFields();

        // âœ… × ×™×§×•×™ ×”×•×“×¢×•×ª ×©×’×™××”
        hideError("customerName");
        hideError("projectName");
        hideError("contactPerson");
        hideError("taskDescription");

        // âœ… ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×”×˜×•×¤×¡ ××—×“×© (××•× ×¢ ×©×œ×™×—×” ×‘×˜×¢×•×ª)
        validateForm();

        console.log("âœ… ×›×œ ×”×©×“×•×ª ××•×¤×¡×• ×‘×”×¦×œ×—×”.");

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×›×œ×œ×™×ª ×‘×¤×•× ×§×¦×™×” resetFormFields:", error);
    }
}


/**
 * ğŸš€ ×’×•×œ×œ ××•×˜×•××˜×™×ª ×œ×›×¤×ª×•×¨ ×”×©×œ×™×—×” ×›××©×¨ ××•×¡×™×¤×™× ××™×© ×§×©×¨ ×—×“×©
 */
function scrollToSubmitButton() {
    try {
        let submitButton = document.getElementById("submitButton");
        if (!submitButton) {
            console.warn("âš ï¸ ×›×¤×ª×•×¨ '×©×œ×—' ×œ× × ××¦× ×‘-DOM.");
            return;
        }

        console.log("ğŸ“œ ××‘×¦×¢ ×’×œ×™×œ×” ××•×˜×•××˜×™×ª ×œ×›×¤×ª×•×¨ ×”×©×œ×™×—×”.");
        submitButton.scrollIntoView({ behavior: "smooth", block: "center" });
    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×’×œ×™×œ×” ×œ×›×¤×ª×•×¨ ×”×©×œ×™×—×”:", error);
    }
}

// ×××–×™×Ÿ ×œ×©×™× ×•×™ ×‘×©×“×” "××™×© ×§×©×¨"
document.getElementById("contactPerson").addEventListener("change", function () {
    try {
        console.log("ğŸ“Œ ×©×™× ×•×™ ×‘×¢×¨×š ××™×© ×§×©×¨:", this.value);
        if (this.value === "new") {
            setTimeout(scrollToSubmitButton, 300); // ×’×•×œ×œ×™× ××—×¨×™ 300ms ×›×“×™ ×œ××¤×©×¨ ×œ×˜×•×¤×¡ ×œ×”×ª××¨×š
        }
    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×”××–× ×” ×œ×©×“×” '××™×© ×§×©×¨':", error);
    }
});


/**
 * ğŸš€ submitForm - ×¤×•× ×§×¦×™×” ×œ×©×™×’×•×¨ ×”× ×ª×•× ×™× ×œ×©×¨×ª.
 *
 * ğŸ”¹ ×ª×”×œ×™×š ×”×¢×‘×•×“×”:
 * 1ï¸âƒ£ ×”×©×‘×ª×ª ×”×˜×•×¤×¡ ×›×“×™ ×œ×× ×•×¢ ×©×œ×™×—×” ×›×¤×•×œ×”.
 * 2ï¸âƒ£ ×”×¦×’×ª ×—×™×•×•×™ ×œ××©×ª××© ×¢×œ ×¤×¢×•×œ×ª ×”×©×œ×™×—×”.
 * 3ï¸âƒ£ ××™×¡×•×£ ×”× ×ª×•× ×™× ××›×œ ×”×©×“×•×ª ×‘×˜×•×¤×¡.
 * 4ï¸âƒ£ ×©×œ×™×—×ª ×”× ×ª×•× ×™× ×œ×©×¨×ª ×“×¨×š Google Apps Script.
 * 5ï¸âƒ£ ×˜×™×¤×•×œ ×‘×ª×’×•×‘×” â€“ ×”×¦×œ×—×” ××• ×›×™×©×œ×•×Ÿ.
 */
function submitForm() {
    try {
        console.log("ğŸ“© ×”×ª×—×œ×ª ×©×œ×™×—×ª ×”× ×ª×•× ×™× ×œ×©×¨×ª...");

        // âœ… ×’×œ×™×œ×” ×œ××¢×œ×” ×›×“×™ ×œ×”×¦×™×’ ××ª ×—×™×•×•×™ ×”×©×œ×™×—×”
        scrollToTop();

        let submitButton = document.getElementById("submitButton");
        let statusMessage = document.getElementById("loadingMessage");

        // ğŸ›‘ ×”×©×‘×ª×ª ×”×›×¤×ª×•×¨ ×œ×× ×™×¢×ª ×©×œ×™×—×” ×›×¤×•×œ×”
        submitButton.disabled = true;
        statusMessage.innerText = "â³ ×©×•×œ×— × ×ª×•× ×™×... ×× × ×”××ª×Ÿ";
        statusMessage.style.display = "block";

        // ğŸ“‹ ××™×¡×•×£ ×”× ×ª×•× ×™× ××”×˜×•×¤×¡
        let formData = {
            customerName: document.getElementById("customerName").value.trim(),
            customerID: document.getElementById("customerID").value.trim(),
            projectName: document.getElementById("projectName").value.trim(),
            projectID: document.getElementById("projectID").value.trim(),
            contactPerson: document.getElementById("contactPerson").value.trim(),
            activityLogLink: document.getElementById("activityLogLink").value.trim(),
            taskDescription: document.getElementById("taskDescription").value.trim(),
            taskID: document.getElementById("taskID").value.trim(),
            creationDate: document.getElementById("creationDate").value.trim(),
            entryDate: document.getElementById("entryDate").value.trim(),
            monthEntry: document.getElementById("monthEntry").value.trim(),
            yearEntry: document.getElementById("yearEntry").value.trim(),
            startTime: document.getElementById("startTime").value.trim()
        };

        // ğŸ”¹ ×× × ×‘×—×¨ "â• ×”×•×¡×£ ××™×© ×§×©×¨ ×—×“×©" - × ×•×¡×™×£ ×’× ××ª ×¤×¨×˜×™×•
        if (formData.contactPerson === "new") {
            formData.newContact = {
                name: document.getElementById("newContactName").value.trim(),
                phone: document.getElementById("newContactPhone").value.trim(),
                email: document.getElementById("newContactEmail").value.trim()
            };
        }

        console.log("ğŸ“Š ×©×•×œ×— ××ª ×”× ×ª×•× ×™× ×œ×©×¨×ª:", formData);

        // ğŸš€ ×©×œ×™×—×ª ×”× ×ª×•× ×™× ×œ×©×¨×ª â€“ ×›×œ ×”×”×—×œ×˜×•×ª ×™×ª×‘×¦×¢×• ×©×
        google.script.run
            .withSuccessHandler(formSubmissionSuccess)
            .withFailureHandler(formSubmissionFailure)
            .saveTaskData(formData); // âœ… ×©×™× ×•×™ ×œ×©× ×”×¤×•× ×§×¦×™×” ×”××ª××™××” ×‘×©×¨×ª

    } catch (error) {
        console.error("âŒ ×©×’×™××” ×›×œ×œ×™×ª ×‘×¤×•× ×§×¦×™×” submitForm:", error);
        alert("âŒ ×©×’×™××” ×›×œ×œ×™×ª ×‘×©×œ×™×—×ª ×”× ×ª×•× ×™×. × ×¡×” ×©×•×‘.");
        submitButton.disabled = false;
        statusMessage.style.display = "none";
    }
}




/**
 * ğŸš€ ×’×•×œ×œ ××•×˜×•××˜×™×ª ×œ×¨××© ×”×“×£ ×›×“×™ ×œ×”×¦×™×’ ××ª ×—×™×•×•×™ ×”×©×œ×™×—×”
 */
function scrollToTop() {
    try {
        console.log("ğŸ“œ ××‘×¦×¢ ×’×œ×™×œ×” ××•×˜×•××˜×™×ª ×œ×¨××© ×”×“×£.");
        window.scrollTo({ top: 0, behavior: "smooth" });
    } catch (error) {
        console.error("âŒ ×©×’×™××” ×‘×’×œ×™×œ×” ×œ×¨××© ×”×“×£:", error);
    }
}

// ×××–×™×Ÿ ×œ×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨ "×©×œ×—"
let submitButton = document.getElementById("submitButton");

if (submitButton) {
    submitButton.addEventListener("click", function () {
        try {
            console.log("ğŸ“Œ ×œ×—×™×¦×” ×¢×œ '×©×œ×—' â€“ ××‘×¦×¢ ×’×œ×™×œ×” ×œ××¢×œ×”.");
            scrollToTop();
        } catch (error) {
            console.error("âŒ ×©×’×™××” ×‘×”××–× ×” ×œ×œ×—×™×¦×” ×¢×œ '×©×œ×—':", error);
        }
    });
}



/**
 * ××˜×¤×œ ×‘×ª×’×•×‘×” ××”×©×¨×ª ×œ××—×¨ ×©×œ×™×—×ª ×”× ×ª×•× ×™×.
 * 
 * ×ª×”×œ×™×š ×”×¢×‘×•×“×”:
 * 1. ×‘×•×“×§ ××ª ×”×ª×•×¦××” ×©×”×•×—×–×¨×” ××”×©×¨×ª (`result`).
 * 2. ×× ×”×ª×•×¦××” ×”×™× `"success"` - ××¦×™×’ ×”×•×“×¢×ª ×”×¦×œ×—×”, ×××ª×™×Ÿ 2 ×©× ×™×•×ª, ×•×¡×•×’×¨ ××ª ×”×˜×•×¤×¡.
 * 3. ×× ×”×ª×•×¦××” ×”×™× `"error"` - ××¦×™×’ ×”×•×“×¢×ª ×©×’×™××” ×œ××©×ª××© ×•××¤×¢×™×œ ××—×“×© ××ª ×›×¤×ª×•×¨ ×”×©×œ×™×—×”.
 *
 * @param {string} result - ×ª×•×¦××ª ×”×‘×§×©×” ××”×©×¨×ª ("success" ××• "error").
 */
function formSubmissionSuccess(result) {
    console.log("ğŸ“© ×§×™×‘×œ× ×• ×ª×©×•×‘×” ×-Google Apps Script:", result);

    let statusMessage = document.getElementById("loadingMessage");
    let submitButton = document.getElementById("submitButton");

    if (result === "success") {
        statusMessage.innerText = "âœ… ×”× ×ª×•× ×™× × ×©××¨×• ×‘×”×¦×œ×—×”!";
        console.log("âœ… ×”× ×ª×•× ×™× × ×©××¨×• ×‘×”×¦×œ×—×” ×‘×˜×‘×œ×”.");
        setTimeout(() => google.script.host.close(), 2000); // â³ ×¡×’×™×¨×ª ×”×˜×•×¤×¡ ××—×¨×™ 2 ×©× ×™×•×ª
    } else {
        statusMessage.innerText = "âŒ ×©×’×™××” ×‘×©××™×¨×ª ×”× ×ª×•× ×™×, × ×¡×” ×©×•×‘.";
        submitButton.disabled = false; // ğŸ”„ ×”×¤×¢×œ×ª ×”×›×¤×ª×•×¨ ××—×“×©
    }
}

/**
 * ××˜×¤×œ ×‘×›×©×œ ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª.
 * 
 * ×ª×”×œ×™×š ×”×¢×‘×•×“×”:
 * 1. ××¦×™×’ ×”×•×“×¢×ª ×©×’×™××” ×œ××©×ª××©.
 * 2. ×××¤×©×¨ × ×™×¡×™×•×Ÿ ×—×•×–×¨ ×¢×œ ×™×“×™ ×”×¤×¢×œ×ª ×›×¤×ª×•×¨ ×”×©×œ×™×—×” ××—×“×©.
 *
 * @param {Object} error - ×”×•×“×¢×ª ×”×©×’×™××” ×©×—×–×¨×” ××”×©×¨×ª.
 */
function formSubmissionFailure(error) {
    console.error("âŒ ×›×©×œ ×‘×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª:", error);

    let statusMessage = document.getElementById("loadingMessage");
    let submitButton = document.getElementById("submitButton");

    statusMessage.innerText = "âŒ ×©×’×™××” ×‘×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª. × ×¡×” ×©×•×‘.";
    submitButton.disabled = false; // ğŸ”„ ×”×¤×¢×œ×ª ×”×›×¤×ª×•×¨ ××—×“×© ×›×“×™ ×œ××¤×©×¨ × ×™×¡×™×•×Ÿ ×—×•×–×¨
}
    </script>
</head>
<body>
    <div class="form-container">
        <h2>×¤×ª×™×—×ª ××©×™××” ×—×“×©×”</h2>
        <div id="loadingMessage" class="loading-message">
         ğŸ”„ ×˜×•×¢×Ÿ × ×ª×•× ×™×... ×× × ×”××ª×Ÿ
         <span class="spinner"></span>
        </div>
        
        <div class="form-group">
            <label>×©× ×œ×§×•×—:</label>
            <input type="text" id="customerName" autocomplete="off" required>
            <div id="customerSuggestions" class="autocomplete-suggestions"></div>
            <div id="customerError" class="error-message"></div>
        </div>
        <div class="form-group">
            <label>××–×”×” ×œ×§×•×—:</label>
            <input type="text" id="customerID" readonly>
        </div>
        <div class="form-group">
            <label>×¤×¨×•×™×§×˜ ×¤×ª×•×—:</label>
            <select id="projectName">
                <option value="">×‘×—×¨ ×¤×¨×•×™×§×˜...</option>
            </select>
            <div id="projectNameError" class="error-message"></div> <!-- âœ… ×©×“×” ×”×•×“×¢×ª ×”×©×’×™××” × ×•×¡×£ ×›××Ÿ -->
        </div>
        <div class="form-group">
            <label>××–×”×” ×¤×¨×•×™×§×˜:</label>
            <input type="text" id="projectID" readonly>
        </div>
        <div class="form-group">
            <label>××™×© ×§×©×¨:</label>
            <input type="text" id="contactPerson" readonly>
        </div>
        <div class="form-group">
            <label>×§×™×©×•×¨ ×œ×œ×•×’ ×¤×¢×™×œ×•×ª:</label>
            <input type="text" id="activityLogLink" name="activityLogLink" readonly>
        </div>
        <div class="form-group">
            <label>×ª×™××•×¨ ×”××©×™××”:</label>
            <input type="text" id="taskDescription" maxlength="60">
            <div id="taskDescriptionError" class="error-message"></div> <!-- âœ… ×©×“×” ×”×•×“×¢×ª ×”×©×’×™××” × ×•×¡×£ ×›××Ÿ -->
        </div>
        
        <!-- ×©×“×•×ª ××•×˜×•××˜×™×™× -->
        <div class="form-group">
            <label>×ª××¨×™×š ×™×¦×™×¨×ª ×©×•×¨×”:</label>
            <input type="text" id="creationDate" readonly>
        </div>
        <div class="form-group">
            <label>××–×”×” ××©×™××”:</label>
            <input type="text" id="taskID" readonly>
        </div>
        <div class="form-group">
            <label>×ª××¨×™×š ×›× ×™×¡×” ×œ××¢×¨×›×ª:</label>
            <input type="text" id="entryDate" readonly>
        </div>
        <div class="form-group">
            <label>×—×•×“×© ×›× ×™×¡×”:</label>
            <input type="text" id="monthEntry" readonly>
        </div>
        <div class="form-group">
            <label>×©× ×ª ×›× ×™×¡×”:</label>
            <input type="text" id="yearEntry" readonly>
        </div>
        <div class="form-group">
            <label>××©×¢×”:</label>
            <input type="text" id="startTime" readonly>
        </div>

        <div class="button-container">
            <button id="cancelButton" onclick="google.script.host.close()">×‘×™×˜×•×œ</button>
            <button id="submitButton" type="button" disabled onclick="submitForm()">××™×©×•×¨</button>
        </div>
    </div>
</body>
</html>
